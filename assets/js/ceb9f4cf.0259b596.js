"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[225],{8842:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>x,frontMatter:()=>c,metadata:()=>l,toc:()=>t});const l=JSON.parse('{"id":"Cyber-Security/Red_Team/Powershell","title":"Red Team - \u4e0d\u958b\u555f Powershell \u57f7\u884c powershell.exe","description":"\u591a\u7a2e\u65b9\u6cd5\u53ef\u4ee5\u9593\u63a5\u57f7\u884c PowerShell \u547d\u4ee4\u6216\u8173\u672c\u3002","source":"@site/docs/Cyber-Security/Red_Team/Powershell.md","sourceDirName":"Cyber-Security/Red_Team","slug":"/Cyber-Security/Red_Team/Powershell","permalink":"/docs/Cyber-Security/Red_Team/Powershell","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"sidebar_label":"\u7d05\u968a\u5b89\u5168 | \u4e0d\u958b\u555f Powershell \u57f7\u884c powershell.exe"},"sidebar":"tutorialSidebar","previous":{"title":"\u7d05\u968a\u5b89\u5168 | Linux \u5f8c\u6ef2\u900f","permalink":"/docs/Cyber-Security/Red_Team/Linux_Post_Exploitation"},"next":{"title":"\u7d05\u968a\u5b89\u5168 | Windows \u5f8c\u6ef2\u900f","permalink":"/docs/Cyber-Security/Red_Team/Windows_Post_Exploitation"}}');var d=s(4848),r=s(8453);const c={sidebar_label:"\u7d05\u968a\u5b89\u5168 | \u4e0d\u958b\u555f Powershell \u57f7\u884c powershell.exe"},i="Red Team - \u4e0d\u958b\u555f Powershell \u57f7\u884c powershell.exe",o={},t=[{value:"1.  <strong>\u4f7f\u7528 <code>cmd.exe</code> \u642d\u914d <code>-WindowStyle Hidden</code> \u53c3\u6578\uff1a</strong>",id:"1--\u4f7f\u7528-cmdexe-\u642d\u914d--windowstyle-hidden-\u53c3\u6578",level:2},{value:"2.  <strong>\u4f7f\u7528 <code>start</code> \u547d\u4ee4\u7684 <code>/B</code> \u9078\u9805 (\u5728 <code>cmd.exe</code> \u4e2d)\uff1a</strong>",id:"2--\u4f7f\u7528-start-\u547d\u4ee4\u7684-b-\u9078\u9805-\u5728-cmdexe-\u4e2d",level:2},{value:"3.  <strong>\u4f7f\u7528 Windows Script Host (<code>cscript.exe</code> \u6216 <code>wscript.exe</code>)\uff1a</strong>",id:"3--\u4f7f\u7528-windows-script-host-cscriptexe-\u6216-wscriptexe",level:2},{value:"4.  <strong>\u4f7f\u7528 <code>mshta.exe</code>\uff1a</strong>",id:"4--\u4f7f\u7528-mshtaexe",level:2},{value:"5.  <strong>\u4f7f\u7528\u5de5\u4f5c\u6392\u7a0b\u5668 (Task Scheduler)\uff1a</strong>",id:"5--\u4f7f\u7528\u5de5\u4f5c\u6392\u7a0b\u5668-task-scheduler",level:2},{value:"6.  <strong>\u4f7f\u7528 <code>wmic.exe</code>\uff1a</strong>",id:"6--\u4f7f\u7528-wmicexe",level:2},{value:"7.  <strong>\u900f\u904e\u5176\u4ed6\u7a0b\u5f0f\u8a9e\u8a00\u547c\u53eb\uff1a</strong>",id:"7--\u900f\u904e\u5176\u4ed6\u7a0b\u5f0f\u8a9e\u8a00\u547c\u53eb",level:2},{value:"8.  <strong>\u900f\u904e Office VBA \u5de8\u96c6\uff1a</strong>",id:"8--\u900f\u904e-office-vba-\u5de8\u96c6",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"red-team---\u4e0d\u958b\u555f-powershell-\u57f7\u884c-powershellexe",children:"Red Team - \u4e0d\u958b\u555f Powershell \u57f7\u884c powershell.exe"})}),"\n",(0,d.jsxs)(n.p,{children:["\u591a\u7a2e\u65b9\u6cd5\u53ef\u4ee5\u9593\u63a5\u57f7\u884c PowerShell \u547d\u4ee4\u6216\u8173\u672c\u3002\r\n\u901a\u5e38\u662f\u900f\u904e\u5176\u4ed6 Windows \u7a0b\u5e8f\u4f86\u547c\u53eb ",(0,d.jsx)(n.code,{children:"powershell.exe"})," \u4e26\u5229\u7528\u5176\u53c3\u6578\u4f86\u96b1\u85cf\u8996\u7a97\uff0c\u6216\u662f\u5229\u7528\u80fd\u57f7\u884c\u8173\u672c\u7684\u74b0\u5883\u3002"]}),"\n",(0,d.jsxs)(n.h2,{id:"1--\u4f7f\u7528-cmdexe-\u642d\u914d--windowstyle-hidden-\u53c3\u6578",children:["1.  ",(0,d.jsxs)(n.strong,{children:["\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"cmd.exe"})," \u642d\u914d ",(0,d.jsx)(n.code,{children:"-WindowStyle Hidden"})," \u53c3\u6578\uff1a"]})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u4f60\u53ef\u4ee5\u5728\u547d\u4ee4\u63d0\u793a\u5b57\u5143 (",(0,d.jsx)(n.code,{children:"cmd.exe"}),") \u6216\u6279\u6b21\u6a94 (",(0,d.jsx)(n.code,{children:".bat"}),", ",(0,d.jsx)(n.code,{children:".cmd"}),") \u4e2d\u547c\u53eb ",(0,d.jsx)(n.code,{children:"powershell.exe"}),"\uff0c\u4e26\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"-WindowStyle Hidden"})," \u53c3\u6578\u4f86\u57f7\u884c\u547d\u4ee4\uff0c\u9019\u6a23 PowerShell \u8996\u7a97\u5c31\u4e0d\u6703\u986f\u793a\u51fa\u4f86\u3002"]}),"\n",(0,d.jsx)(n.li,{children:"\u7bc4\u4f8b\uff1a"}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cmd",children:'cmd.exe /c powershell.exe -WindowStyle Hidden -Command "Get-Process | Out-File C:\\temp\\processes.txt"\n'})}),"\n",(0,d.jsxs)(n.p,{children:["\u6216\u8005\u76f4\u63a5\u5728 ",(0,d.jsx)(n.code,{children:"cmd"})," \u88e1\u57f7\u884c\uff1a"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cmd",children:"powershell.exe -WindowStyle Hidden -EncodedCommand <Base64EncodedCommand>\n"})}),"\n",(0,d.jsxs)(n.p,{children:["(",(0,d.jsx)(n.code,{children:"-EncodedCommand"})," \u7528\u65bc\u57f7\u884c Base64 \u7de8\u78bc\u5f8c\u7684\u547d\u4ee4\uff0c\u907f\u514d\u7279\u6b8a\u5b57\u5143\u554f\u984c)\u3002"]}),"\n",(0,d.jsxs)(n.h2,{id:"2--\u4f7f\u7528-start-\u547d\u4ee4\u7684-b-\u9078\u9805-\u5728-cmdexe-\u4e2d",children:["2.  ",(0,d.jsxs)(n.strong,{children:["\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"start"})," \u547d\u4ee4\u7684 ",(0,d.jsx)(n.code,{children:"/B"})," \u9078\u9805 (\u5728 ",(0,d.jsx)(n.code,{children:"cmd.exe"})," \u4e2d)\uff1a"]})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"start /B"})," \u6703\u5728\u76ee\u524d\u7684 ",(0,d.jsx)(n.code,{children:"cmd"})," \u8996\u7a97\u4e2d\u555f\u52d5\u61c9\u7528\u7a0b\u5f0f\uff0c\u4e14\u4e0d\u5efa\u7acb\u65b0\u8996\u7a97\u3002\u96d6\u7136 ",(0,d.jsx)(n.code,{children:"powershell.exe"})," \u672c\u8eab\u53ef\u80fd\u9084\u662f\u6703\u5617\u8a66\u5efa\u7acb\u8996\u7a97\uff0c\u4f46\u7d50\u5408 ",(0,d.jsx)(n.code,{children:"-WindowStyle Hidden"})," \u66f4\u53ef\u9760\u3002\u55ae\u7368\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"start /B"})," \u53ef\u80fd\u4e0d\u8db3\u4ee5\u5b8c\u5168\u96b1\u85cf\u3002"]}),"\n",(0,d.jsx)(n.li,{children:"\u7bc4\u4f8b\uff1a"}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cmd",children:'start /B powershell.exe -WindowStyle Hidden -Command "..."\n'})}),"\n",(0,d.jsxs)(n.h2,{id:"3--\u4f7f\u7528-windows-script-host-cscriptexe-\u6216-wscriptexe",children:["3.  ",(0,d.jsxs)(n.strong,{children:["\u4f7f\u7528 Windows Script Host (",(0,d.jsx)(n.code,{children:"cscript.exe"})," \u6216 ",(0,d.jsx)(n.code,{children:"wscript.exe"}),")\uff1a"]})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u53ef\u4ee5\u7de8\u5beb VBScript \u6216 JScript \u8173\u672c\uff0c\u5229\u7528 ",(0,d.jsx)(n.code,{children:"WScript.Shell"})," \u7269\u4ef6\u7684 ",(0,d.jsx)(n.code,{children:"Run"})," \u65b9\u6cd5\u4f86\u57f7\u884c PowerShell\uff0c\u4e26\u4e14\u53ef\u4ee5\u6307\u5b9a\u8996\u7a97\u6a23\u5f0f\u70ba\u96b1\u85cf (\u53c3\u6578 ",(0,d.jsx)(n.code,{children:"0"}),")\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:["\u7bc4\u4f8b (VBScript, ",(0,d.jsx)(n.code,{children:"run_hidden.vbs"}),"):"]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-vbscript",children:'Set objShell = CreateObject("WScript.Shell")\r\ncommand = "powershell.exe -WindowStyle Hidden -Command ""& { Get-Date | Out-File C:\\temp\\current_date.txt }"""\r\nobjShell.Run command, 0, True \' 0 = Hidden Window, True = Wait for command to complete\r\nSet objShell = Nothing\n'})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u57f7\u884c\uff1a",(0,d.jsx)(n.code,{children:"cscript //nologo run_hidden.vbs"})," \u6216 ",(0,d.jsx)(n.code,{children:"wscript run_hidden.vbs"})," (wscript \u9810\u8a2d\u4e0d\u6703\u986f\u793a\u4e3b\u63a7\u53f0\u8996\u7a97)"]}),"\n"]}),"\n",(0,d.jsxs)(n.h2,{id:"4--\u4f7f\u7528-mshtaexe",children:["4.  ",(0,d.jsxs)(n.strong,{children:["\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"mshta.exe"}),"\uff1a"]})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"mshta.exe"})," \u53ef\u4ee5\u57f7\u884c HTML Applications (.hta) \u6216\u76f4\u63a5\u57f7\u884c VBScript/JScript\u3002\u985e\u4f3c\u65bc WSH\uff0c\u53ef\u4ee5\u5728\u8173\u672c\u4e2d\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"WScript.Shell"})," \u6216\u5176\u4ed6 COM \u7269\u4ef6\u4f86\u9593\u63a5\u3001\u96b1\u85cf\u5730\u57f7\u884c PowerShell\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:["\u7bc4\u4f8b (\u76f4\u63a5\u5728 ",(0,d.jsx)(n.code,{children:"cmd"})," \u4e2d\u57f7\u884c):"]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cmd",children:'mshta.exe vbscript:Execute("Set objShell = CreateObject(""WScript.Shell""): objShell.Run ""powershell.exe -WindowStyle Hidden -Command """"& { Get-Service | Out-File C:\\temp\\services.txt }"""""", 0, True: window.close")\n'})}),"\n",(0,d.jsxs)(n.h2,{id:"5--\u4f7f\u7528\u5de5\u4f5c\u6392\u7a0b\u5668-task-scheduler",children:["5.  ",(0,d.jsx)(n.strong,{children:"\u4f7f\u7528\u5de5\u4f5c\u6392\u7a0b\u5668 (Task Scheduler)\uff1a"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u53ef\u4ee5\u5efa\u7acb\u4e00\u500b\u6392\u7a0b\u5de5\u4f5c\uff0c\u8a2d\u5b9a\u5176\u57f7\u884c ",(0,d.jsx)(n.code,{children:"powershell.exe"}),"\uff0c\u4e26\u5728\u5de5\u4f5c\u8a2d\u5b9a\u4e2d\u52fe\u9078\u300c\u4ee5\u6700\u9ad8\u6b0a\u9650\u57f7\u884c\u300d\u548c\u300c\u96b1\u85cf\u57f7\u884c\u300d\u3002\u9019\u6a23\u5de5\u4f5c\u6703\u5728\u80cc\u666f\u57f7\u884c\uff0c\u4e0d\u6703\u6709\u53ef\u898b\u8996\u7a97\u3002"]}),"\n",(0,d.jsx)(n.li,{children:"\u8a2d\u5b9a\u6b65\u9a5f\uff1a"}),"\n"]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"\u958b\u555f Task Scheduler\u3002"}),"\n",(0,d.jsx)(n.li,{children:"\u5efa\u7acb\u57fa\u672c\u5de5\u4f5c\u6216\u5efa\u7acb\u5de5\u4f5c\u3002"}),"\n",(0,d.jsxs)(n.li,{children:["\u5728\u300c\u52d5\u4f5c\u300d\u9801\u7c64\u4e2d\uff0c\u8a2d\u5b9a\u7a0b\u5f0f\u70ba ",(0,d.jsx)(n.code,{children:"powershell.exe"}),"\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:["\u5728\u300c\u5f15\u6578\u300d\u6b04\u4f4d\u4e2d\uff0c\u586b\u5165 ",(0,d.jsx)(n.code,{children:'-WindowStyle Hidden -Command "..."'})," \u6216 ",(0,d.jsx)(n.code,{children:'-File "C:\\path\\to\\script.ps1"'}),"\u3002"]}),"\n",(0,d.jsx)(n.li,{children:"\u5728\u300c\u4e00\u822c\u300d\u9801\u7c64\u4e2d\uff0c\u53ef\u4ee5\u9078\u64c7\u57f7\u884c\u6642\u4f7f\u7528\u7684\u4f7f\u7528\u8005\u5e33\u6236\uff0c\u4e26\u52fe\u9078\u300c\u96b1\u85cf\u300d\u3002"}),"\n"]}),"\n",(0,d.jsxs)(n.h2,{id:"6--\u4f7f\u7528-wmicexe",children:["6.  ",(0,d.jsxs)(n.strong,{children:["\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"wmic.exe"}),"\uff1a"]})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"wmic"})," \u53ef\u4ee5\u7528\u4f86\u57f7\u884c\u7a0b\u5e8f\u3002\u96d6\u7136\u5b83\u672c\u8eab\u662f\u5728\u547d\u4ee4\u5217\u57f7\u884c\uff0c\u4f46\u53ef\u4ee5\u7528\u4f86\u555f\u52d5\u5176\u4ed6\u7a0b\u5e8f\uff0c\u7d50\u5408 ",(0,d.jsx)(n.code,{children:"-WindowStyle Hidden"})," \u4e5f\u80fd\u9054\u5230\u76ee\u7684\u3002"]}),"\n",(0,d.jsx)(n.li,{children:"\u7bc4\u4f8b\uff1a"}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cmd",children:'wmic process call create "powershell.exe -WindowStyle Hidden -Command \\"Get-ChildItem C:\\ | Out-File C:\\temp\\root_dir.txt\\""\n'})}),"\n",(0,d.jsx)(n.p,{children:"(\u6ce8\u610f\u5f15\u865f\u7684\u8df3\u812b)"}),"\n",(0,d.jsxs)(n.h2,{id:"7--\u900f\u904e\u5176\u4ed6\u7a0b\u5f0f\u8a9e\u8a00\u547c\u53eb",children:["7.  ",(0,d.jsx)(n.strong,{children:"\u900f\u904e\u5176\u4ed6\u7a0b\u5f0f\u8a9e\u8a00\u547c\u53eb\uff1a"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u50cf\u662f C#, Python, Go \u7b49\u7a0b\u5f0f\u8a9e\u8a00\u90fd\u53ef\u4ee5\u547c\u53eb\u5916\u90e8\u7a0b\u5e8f\u3002\u5b83\u5011\u901a\u5e38\u6709\u9078\u9805\u53ef\u4ee5\u63a7\u5236\u5b50\u7a0b\u5e8f\u7684\u8996\u7a97\u662f\u5426\u986f\u793a\u3002"}),"\n",(0,d.jsx)(n.li,{children:"\u7bc4\u4f8b (Python):"}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"import subprocess\r\nimport os\r\n\r\ncmd = ['powershell.exe', '-WindowStyle', 'Hidden', '-Command', 'Get-Process > C:\\\\temp\\\\py_processes.txt']\r\n\r\n# Hide the console window on Windows\r\nstartupinfo = subprocess.STARTUPINFO()\r\nstartupinfo.dwFlags |= subprocess.STARTF_USESHOWWINDOW\r\nstartupinfo.wShowWindow = subprocess.SW_HIDE # Use 0 for SW_HIDE\r\n\r\nsubprocess.run(cmd, startupinfo=startupinfo, shell=False) # shell=False is safer\n"})}),"\n",(0,d.jsxs)(n.h2,{id:"8--\u900f\u904e-office-vba-\u5de8\u96c6",children:["8.  ",(0,d.jsx)(n.strong,{children:"\u900f\u904e Office VBA \u5de8\u96c6\uff1a"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u5728 Word\u3001Excel \u7b49 Office \u6587\u4ef6\u4e2d\u7684 VBA \u5de8\u96c6\u53ef\u4ee5\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"Shell"})," \u51fd\u6578\u6216 ",(0,d.jsx)(n.code,{children:"WScript.Shell"})," \u7269\u4ef6\u4f86\u96b1\u85cf\u5730\u57f7\u884c PowerShell\u3002\u9019\u662f\u60e1\u610f\u8edf\u9ad4\u5e38\u7528\u7684\u624b\u6cd5\u3002"]}),"\n",(0,d.jsx)(n.li,{children:"\u7bc4\u4f8b (VBA):"}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-vba",children:'Sub RunHiddenPS()\r\nDim shell As Object\r\nSet shell = CreateObject("WScript.Shell")\r\nDim command As String\r\ncommand = "powershell.exe -WindowStyle Hidden -Command ""& { Write-Output \'Hello from VBA\' | Out-File C:\\temp\\vba_output.txt }"""\r\nshell.Run command, 0, True \' 0 = Hidden Window\r\nSet shell = Nothing\r\nEnd Sub\n'})})]})}function x(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>i});var l=s(6540);const d={},r=l.createContext(d);function c(e){const n=l.useContext(r);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:c(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);